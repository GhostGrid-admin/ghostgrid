<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forum ‚Äì GhostGrid</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      margin: 0;
      background-color: #050505;
      color: #e0ffff;
      font-family: 'Courier New', monospace;
      min-height: 100vh;
      overflow-x: hidden;
    }
    nav.navbar {
      background-color: #000;
      border-bottom: 2px solid #bb00ff;
      padding: 12px 0;
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 1000;
      display: flex;
      justify-content: center;
    }
    .nav-content {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 40px;
      width: 100%;
      max-width: 900px;
      align-items: center;
      text-align: center;
    }
    .nav-content a {
      color: #fff;
      text-decoration: none;
      font-size: 1.22em;
      font-family: inherit;
      padding: 7px 20px;
      border-radius: 7px;
      text-shadow: 0 0 8px #bb00ff;
      transition: 0.3s;
      font-weight: bold;
    }
    .nav-content a.active, .nav-content a:hover {
      background: #bb00ff;
      color: #000;
      box-shadow: 0 0 12px #fff;
      text-shadow: none;
    }
    .nav-content .search-container {
      margin-left: 20px;
    }
    .nav-content input[type="text"] {
      padding: 6px 18px;
      border-radius: 8px;
      border: 1px solid #00ffcc;
      background: #151515;
      color: #fff;
      font-size: 1em;
      outline: none;
      min-width: 190px;
      margin-top: 2px;
    }

    /* --- SIDOREKLAMER --- */
    .ad-side {
      position: fixed;
      top: 0;
      bottom: 0;
      width: 86px;
      z-index: 0;
      display: flex;
      flex-direction: column;
      justify-content: stretch;
      align-items: stretch;
      pointer-events: none;
    }
    .ad-left {
      left: 0;
      background: linear-gradient(180deg, #9900ff 60%, #00ffe5 100%);
      border-top-left-radius: 15px;
      border-bottom-left-radius: 15px;
      box-shadow: 0 0 28px #9900ffbb;
    }
    .ad-right {
      right: 0;
      background: linear-gradient(180deg, #00ffe5 60%, #9900ff 100%);
      border-top-right-radius: 15px;
      border-bottom-right-radius: 15px;
      box-shadow: 0 0 28px #00ffe5bb;
    }
    .ad-label {
      color: #fff;
      text-align: center;
      font-size: 1em;
      margin-top: 32vh;
      opacity: 0.7;
      writing-mode: vertical-lr;
      letter-spacing: 2px;
      text-shadow: 0 0 8px #000;
      pointer-events: none;
      font-family: inherit;
      user-select: none;
    }

    /* --- CENTRALT INNEH√ÖLL --- */
    .forum-center {
      max-width: 520px;
      margin: 110px auto 0 auto;
      background: #050505;
      border-radius: 17px;
      box-shadow: 0 0 18px #00ffcc44, 0 0 20px #bb00ff22 inset;
      padding: 2.5vw 3vw 2vw 3vw;
      border: 2.5px solid #00ffcc;
      text-align: center;
      position: relative;
      z-index: 2;
    }
    .forum-center h2 {
      font-size: 2.1em;
      color: #aaffee;
      margin-bottom: 28px;
      margin-top: 0;
      text-shadow: 0 0 9px #bbfff6, 0 0 2px #fff;
      font-family: 'Courier New', monospace;
      letter-spacing: 1.5px;
    }
    .thread-form input, .thread-form textarea {
      width: 100%;
      background: #000;
      border: 1.5px solid #00ffcc;
      border-radius: 5px;
      color: #00ffcc;
      font-family: inherit;
      font-size: 1.1em;
      padding: 8px 10px;
      margin-bottom: 15px;
      margin-top: 2px;
      outline: none;
      box-shadow: 0 0 5px #00ffcc22 inset;
      transition: border 0.18s;
    }
    .thread-form textarea { min-height: 60px; resize: vertical;}
    .thread-form button {
      background: #00ff55;
      color: #000;
      font-size: 1.19em;
      padding: 8px 32px;
      border-radius: 6px;
      border: 1px solid #00ffcc;
      cursor: pointer;
      margin: 10px auto 0 auto;
      font-family: inherit;
      font-weight: bold;
      box-shadow: 0 0 11px #00ffcc99;
      transition: 0.16s;
      display: block;
    }
    .thread-form button:hover { background: #00ffe5; color:#222;}
    #threadsList { margin-top: 26px; }

    /* --- AI-ASSISTENTER --- */
    .ai-footer-wrap {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      width: 100vw;
      max-width: 100vw;
      margin: 0 auto;
      padding-bottom: 26px;
      position: relative;
      z-index: 10;
      gap: 24px;
    }
    .ai-bubble {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 130px;
      max-width: 200px;
      margin: 0 2vw;
      font-size: 1.08em;
      text-align: center;
      user-select: none;
    }
    .ai-bubble.ghost .ai-label { color: #15fff0; font-weight:bold;}
    .ai-bubble.glow .ai-label { color: #ffe44e; font-weight:bold;}
    .ai-icon {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 4px;
      cursor: pointer;
      transition: transform 0.17s;
    }
    .ai-icon:hover { transform: scale(1.13) rotate(-3deg);}
    .ai-desc { font-size: 0.97em; margin-top: 3px; opacity: 0.94;}
    /* Ghost v√§nstertext, Glow h√∂gertext */
    .ai-desc.left { text-align: right; margin-right: 1vw;}
    .ai-desc.right { text-align: left; margin-left: 1vw;}

    /* --- RESPONSIVE --- */
    @media (max-width: 1000px) {
      .ad-side { display: none !important; }
      .forum-center { margin: 100px 1vw 0 1vw; }
      .ai-footer-wrap { flex-direction: column; align-items: center; gap: 10px; }
      .ai-bubble .ai-desc { text-align: center !important; }
    }
    @media (max-width: 650px) {
      .forum-center { padding: 10vw 2vw 5vw 2vw;}
      .ai-footer-wrap { flex-direction: column; gap: 2px; padding-bottom: 16px; }
    }
    /* --- Kommentar/Tr√•d/Knappar --- */
    .thread-card { background:#000b; border-radius:9px; margin:22px 0 12px 0; box-shadow:0 0 10px #00ffcc33; padding:13px 18px;}
    .thread-title { font-size:1.23em; color:#30fff6; font-family:inherit; font-weight:bold; }
    .thread-desc { color:#cdf; margin-bottom:7px;}
    .thread-meta { color:#b6eeff; font-size:.91em; margin-bottom: 6px;}
    .reactions-bar button.selected { background:#30fff6; color:#111; }
    .reactions-bar button { background:none; border:none; font-size:1.35em; margin:0 2px; cursor:pointer;}
    .edit-btn,.delete-btn,.reply-btn { background:#181; color:#fff; border-radius:4px; border:none; padding:3px 8px; margin:0 3px 0 0; font-size:.99em; cursor:pointer;}
    .delete-btn { background:#922;}
    .edit-btn:hover,.delete-btn:hover,.reply-btn:hover { filter:brightness(1.16);}
    .add-comment-box { margin-top:8px;}
    .add-comment-box textarea { width:100%; min-height:32px; border-radius:5px; padding:4px 7px; font-family:inherit;}
    .add-comment-box button { background:#00ffcc; color:#111; border-radius:4px; border:none; font-weight:bold; margin-top:4px;}
    .comment-card { margin:14px 0 2px 0; padding:9px 13px; background:#060d14bb; border-radius:7px; box-shadow:0 0 7px #00ffcc22;}
    .comment-meta { font-size:.88em; color:#aae;}
    .comment-content { margin:2px 0 7px 0; color:#fff;}
    .comment-reactions button.selected { background:#30fff6; color:#111;}
    .comment-reactions button { background:none; border:none; font-size:1.13em; margin:0 2px; cursor:pointer;}
    /* --- Centrera hamburgermeny --- */
    @media (max-width: 900px) {
      .nav-content { flex-direction:column; gap:17px; padding:20px 0; background:#11091e; box-shadow:0 8px 20px #bb00ff99;}
    }
    #menuBtn { display: none; }
    @media (max-width:900px) {
      #menuBtn {
        display:block;
        background:none;
        border:none;
        color:#fff;
        font-size:2.2em;
        position: absolute;
        left: 50%; top: 9px; transform: translateX(-50%);
        z-index:3000;
      }
      .nav-content { display:none;}
      .nav-content.active { display:flex;}
    }
  </style>
  <!-- FIREBASE SETUP -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCR8q40Dc4wcfYBDlxdpOriA2e3RTmAesg",
      authDomain: "ghostgrid-fb278.firebaseapp.com",
      projectId: "ghostgrid-fb278",
      storageBucket: "ghostgrid-fb278.firebasestorage.app",
      messagingSenderId: "283208202937",
      appId: "1:283208202937:web:11c0cea81fd81a31163968",
      measurementId: "G-B0WCKJCNT9"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
  </script>
</head>
<body>
  <!-- SIDREKLAMER -->
  <div class="ad-side ad-left">
    <div class="ad-label">REKLAM V√ÑNSTER</div>
  </div>
  <div class="ad-side ad-right">
    <div class="ad-label">REKLAM H√ñGER</div>
  </div>

  <!-- NAVIGATION -->
  <nav class="navbar">
    <button id="menuBtn" aria-label="Meny">&#9776;</button>
    <div class="nav-content" id="navLinks">
      <a href="forum.html" class="active">Forum</a>
      <a href="store.html">Store</a>
      <a href="wall.html">V√§ggen</a>
      <a href="upload.html">Ladda upp</a>
      <a href="profile.html">Profil</a>
      <a href="friends.html">V√§nner</a>
      <div class="search-container">
        <input type="text" id="globalSearchInput" placeholder="S√∂k p√• hela sidan...">
      </div>
    </div>
  </nav>

  <!-- CENTRALT INNEH√ÖLL -->
  <div class="forum-center">
    <h2 id="threadFormTitle">Skapa ny tr√•d</h2>
    <div class="thread-form">
      <input id="newThreadTitle" type="text" placeholder="Titel p√• tr√•d (t.ex. Matematik)">
      <textarea id="newThreadDesc" placeholder="Beskrivning (valfritt)"></textarea>
      <button id="createThreadBtn">Skapa tr√•d</button>
    </div>
    <div id="threadsList"></div>
  </div>

  <!-- AI-FOOTER CENTRERAT & KLICKBARA -->
  <div class="ai-footer-wrap">
    <div class="ai-bubble ghost">
      <div class="ai-desc left">
        Jag √§r Ghost, din tekniska support som guidar dig r√§tt p√• plattformen och svarar p√• fr√•gor om funktioner, s√§kerhet och allt digitalt.<br>
        <span style="color:#30fff6;">Klicka p√• Ghost f√∂r att chatta!</span>
      </div>
    </div>
    <a class="ai-icon" href="ghost.html" title="Ghost ‚Äì AI teknisk support" style="align-self:center;">
      <svg width="50" height="50" viewBox="0 0 56 56" fill="none">
        <ellipse cx="28" cy="32" rx="16" ry="19" fill="#131b20" stroke="#00ffcc" stroke-width="3"/>
        <ellipse cx="22" cy="32" rx="3.5" ry="3" fill="#fff"/>
        <ellipse cx="34" cy="32" rx="3.5" ry="3" fill="#fff"/>
        <rect x="19.5" y="39" width="17" height="6" rx="3" fill="#232d38"/>
        <rect x="15.5" y="26" width="25" height="11" rx="11" fill="none" stroke="#00ffcc" stroke-width="1"/>
      </svg>
      <div class="ai-label">Ghost</div>
    </a>
    <a class="ai-icon" href="glow.html" title="Glow ‚Äì AI st√∂d & v√§n" style="align-self:center;">
      <svg width="50" height="50" viewBox="0 0 64 64" fill="none">
        <ellipse cx="32" cy="36" rx="14" ry="16" fill="#fffbe8" stroke="#ffe700" stroke-width="2"/>
        <path d="M26 44 Q32 48 38 44" stroke="#ffcc1a" stroke-width="2" fill="none"/>
        <ellipse cx="27" cy="36" rx="2" ry="2.5" fill="#555"/>
        <ellipse cx="37" cy="36" rx="2" ry="2.5" fill="#555"/>
        <g>
          <circle cx="14" cy="28" r="2" fill="#ffe700" opacity="0.7"/>
          <circle cx="48" cy="20" r="1.7" fill="#ffed60" opacity="0.5"/>
          <circle cx="52" cy="40" r="1.3" fill="#fff780" opacity="0.7"/>
          <circle cx="36" cy="17" r="1.1" fill="#fffbc0" opacity="0.6"/>
          <circle cx="18" cy="50" r="1.2" fill="#fffdd2" opacity="0.5"/>
          <circle cx="28" cy="14" r="1.3" fill="#fff780" opacity="0.7"/>
        </g>
      </svg>
      <div class="ai-label">Glow</div>
    </a>
    <div class="ai-bubble glow">
      <div class="ai-desc right">
        Jag √§r Glow! Om du beh√∂ver n√•gon att prata med, f√• st√∂d eller bara vill sprida lite positiv energi ‚Äì chatta med mig n√§r du vill!<br>
        <span style="color:#ffe44e;">Klicka p√• Glow f√∂r att chatta!</span>
      </div>
    </div>
  </div>
  <script>
/* -------------------- SPR√ÖKST√ñD -------------------- */
const translations = {
  sv: {
    createThread: "Skapa ny tr√•d",
    threadTitle: "Titel p√• tr√•d (t.ex. Matematik)",
    threadDesc: "Beskrivning (valfritt)",
    createBtn: "Skapa tr√•d",
    noThreads: "Ingen tr√•d √§nnu ‚Äì skapa en!",
    addComment: "Kommentera",
    edit: "Redigera",
    delete: "Ta bort",
    reply: "Svara",
    save: "Spara",
    cancel: "Avbryt",
    commentPlaceholder: "Skriv din kommentar...",
    loginReq: "Du m√•ste vara inloggad f√∂r att g√∂ra detta.",
    deleteConfirm: "Vill du verkligen ta bort?",
    yes: "Ja",
    no: "Nej"
  },
  en: {
    createThread: "Create new thread",
    threadTitle: "Thread title (e.g. Math)",
    threadDesc: "Description (optional)",
    createBtn: "Create thread",
    noThreads: "No threads yet ‚Äì create one!",
    addComment: "Comment",
    edit: "Edit",
    delete: "Delete",
    reply: "Reply",
    save: "Save",
    cancel: "Cancel",
    commentPlaceholder: "Write your comment...",
    loginReq: "You need to be logged in to do this.",
    deleteConfirm: "Are you sure you want to delete?",
    yes: "Yes",
    no: "No"
  }
};
let lang = (localStorage.language === "en") ? "en" : "sv";
function _(key) { return translations[lang][key] || key; }

function updateLangUI() {
  document.getElementById("threadFormTitle").textContent = _( "createThread");
  document.getElementById("newThreadTitle").placeholder = _( "threadTitle");
  document.getElementById("newThreadDesc").placeholder = _( "threadDesc");
  document.getElementById("createThreadBtn").textContent = _( "createBtn");
}

/* ----------------- EMOJI-REAKTIONER ---------------- */
const REACTIONS = [
  { emoji: "üëç", key: "thumbsup" },
  { emoji: "üëé", key: "thumbsdown" },
  { emoji: "üôÇ", key: "smile" },
  { emoji: "üòÉ", key: "bigsmile" },
  { emoji: "üòÇ", key: "laugh" },
  { emoji: "üòï", key: "confused" },
  { emoji: "üôÅ", key: "sad" },
  { emoji: "üò¢", key: "cry" },
  { emoji: "üò°", key: "angry" },
  { emoji: "üò≥", key: "embarrassed" },
  { emoji: "üòá", key: "angel" }
];

let currentUser = null;

/* -------- H√§mta anv√§ndare --------- */
auth.onAuthStateChanged(user => {
  currentUser = user;
  loadThreads();
});

/* ---------- Skapa ny tr√•d ---------- */
document.getElementById("createThreadBtn").onclick = async function() {
  if (!currentUser) return alert(_( "loginReq"));
  const title = document.getElementById("newThreadTitle").value.trim();
  const desc = document.getElementById("newThreadDesc").value.trim();
  if (!title) return;
  await db.collection("threads").add({
    title, description: desc, creatorUid: currentUser.uid, timestamp: new Date(), reactions: {}
  });
  document.getElementById("newThreadTitle").value = "";
  document.getElementById("newThreadDesc").value = "";
  loadThreads();
};

/* ---------- H√§mta & visa tr√•dar ---------- */
async function loadThreads() {
  const threadsList = document.getElementById("threadsList");
  threadsList.innerHTML = "<div style='color:#31ffff; margin:15px;'>" + _( "noThreads") + "</div>";
  const snap = await db.collection("threads").orderBy("timestamp", "desc").get();
  if (!snap.size) return;
  threadsList.innerHTML = "";
  snap.forEach(doc => renderThread(doc, threadsList));
}

/* ----------- Visa tr√•d --------------- */
function renderThread(doc, container) {
  const data = doc.data();
  const id = doc.id;
  // R√§kna reaktioner
  const reactions = data.reactions || {};
  const counts = {};
  for (const uid in reactions) {
    const react = reactions[uid];
    counts[react] = (counts[react] || 0) + 1;
  }
  // Bygg tr√•d
  const threadDiv = document.createElement("div");
  threadDiv.className = "thread-card";
  threadDiv.innerHTML = `
    <div class="thread-title">${data.title}</div>
    <div class="thread-desc">${data.description || ""}</div>
    <div class="thread-meta">${new Date(data.timestamp?.toDate?.()||data.timestamp).toLocaleString()} </div>
    <div class="reactions-bar">
      ${REACTIONS.map(r =>
        `<button class="reaction-btn${reactions[currentUser?.uid] === r.key ? " selected" : ""}" 
          data-thread="${id}" data-reaction="${r.key}" title="${r.emoji}">
          ${r.emoji}<span class="reaction-count">${counts[r.key] ? counts[r.key] : ""}</span>
        </button>`).join("")}
      ${currentUser && data.creatorUid === currentUser.uid
        ? `<button class="edit-btn" data-thread="${id}">${_( "edit")}</button>
           <button class="delete-btn" data-thread="${id}">${_( "delete")}</button>` : ""}
    </div>
    <div class="add-comment-box" id="addCommentBox_${id}">
      <textarea placeholder="${_( "commentPlaceholder")}"></textarea>
      <button>${_( "addComment")}</button>
    </div>
    <div class="comments-list" id="comments_${id}"></div>
  `;
  container.appendChild(threadDiv);

  // Emoji-reaktioner p√• tr√•d
  threadDiv.querySelectorAll(".reaction-btn").forEach(btn => {
    btn.onclick = async function() {
      if (!currentUser) return alert(_( "loginReq"));
      const threadRef = db.collection("threads").doc(id);
      const docSnap = await threadRef.get();
      let reactions = docSnap.data().reactions || {};
      const key = this.getAttribute("data-reaction");
      if (reactions[currentUser.uid] === key) {
        delete reactions[currentUser.uid];
      } else {
        reactions[currentUser.uid] = key;
      }
      await threadRef.update({ reactions });
      loadThreads();
    };
  });
  // Redigera/radera tr√•d
  threadDiv.querySelectorAll(".edit-btn").forEach(btn => {
    btn.onclick = async function() {
      // Kan l√§gga till edit-funktion h√§r!
    };
  });
  threadDiv.querySelectorAll(".delete-btn").forEach(btn => {
    btn.onclick = async function() {
      if (confirm(_( "deleteConfirm"))) {
        await db.collection("threads").doc(id).delete();
        loadThreads();
      }
    };
  });

  // Kommentarer
  renderComments(id, null, threadDiv.querySelector(".comments-list"), 0);

  // Ny kommentar
  const addBtn = threadDiv.querySelector(".add-comment-box button");
  const textarea = threadDiv.querySelector(".add-comment-box textarea");
  addBtn.onclick = async () => {
    if (!currentUser) return alert(_( "loginReq"));
    const text = textarea.value.trim();
    if (!text) return;
    await db.collection("threads").doc(id)
      .collection("comments").add({
        text, parent: null, creatorUid: currentUser.uid,
        timestamp: new Date(), reactions: {}
      });
    textarea.value = "";
    renderComments(id, null, threadDiv.querySelector(".comments-list"), 0);
  };
}

/* -------- Rekursivt visa kommentarer -------- */
async function renderComments(threadId, parentId, container, depth) {
  container.innerHTML = "";
  const commentsRef = db.collection("threads").doc(threadId).collection("comments");
  const q = parentId ? commentsRef.where("parent", "==", parentId).orderBy("timestamp")
                     : commentsRef.where("parent", "==", null).orderBy("timestamp");
  const snap = await q.get();
  snap.forEach(doc => {
    const data = doc.data(), id = doc.id;
    const commentDiv = document.createElement("div");
    commentDiv.className = "comment-card";
    commentDiv.style.marginLeft = (depth * 28) + "px";
    // R√§kna reaktioner
    const reactions = data.reactions || {};
    const counts = {};
    for (const uid in reactions) {
      const react = reactions[uid];
      counts[react] = (counts[react] || 0) + 1;
    }
    commentDiv.innerHTML = `
      <div class="comment-meta">${new Date(data.timestamp?.toDate?.()||data.timestamp).toLocaleString()}</div>
      <div class="comment-content">${data.text}</div>
      <div class="comment-reactions">
        ${REACTIONS.map(r =>
          `<button class="comment-react${reactions[currentUser?.uid] === r.key ? " selected" : ""}" 
            data-thread="${threadId}" data-comment="${id}" data-reaction="${r.key}" title="${r.emoji}">
            ${r.emoji}<span class="reaction-count">${counts[r.key] ? counts[r.key] : ""}</span>
          </button>`).join("")}
        <button class="reply-btn" data-thread="${threadId}" data-comment="${id}">${_( "reply")}</button>
        ${currentUser && data.creatorUid === currentUser.uid
          ? `<button class="edit-btn" data-thread="${threadId}" data-comment="${id}">${_( "edit")}</button>
             <button class="delete-btn" data-thread="${threadId}" data-comment="${id}">${_( "delete")}</button>` : ""}
      </div>
      <div class="add-comment-box reply" style="display:none;"><textarea placeholder="${_( "commentPlaceholder")}"></textarea>
      <button>${_( "addComment")}</button></div>
      <div class="comments-list"></div>
    `;
    container.appendChild(commentDiv);

    // Emoji-reaktioner p√• kommentar
    commentDiv.querySelectorAll(".comment-react").forEach(btn => {
      btn.onclick = async function() {
        if (!currentUser) return alert(_( "loginReq"));
        const commentRef = db.collection("threads").doc(threadId).collection("comments").doc(id);
        const docSnap = await commentRef.get();
        let reactions = docSnap.data().reactions || {};
        const key = this.getAttribute("data-reaction");
        if (reactions[currentUser.uid] === key) {
          delete reactions[currentUser.uid];
        } else {
          reactions[currentUser.uid] = key;
        }
        await commentRef.update({ reactions });
        renderComments(threadId, parentId, container, depth);
      };
    });

    // Svara/reply
    commentDiv.querySelectorAll(".reply-btn").forEach(btn => {
      btn.onclick = function() {
        const box = commentDiv.querySelector(".add-comment-box.reply");
        box.style.display = box.style.display === "none" ? "block" : "none";
      };
    });
    // L√§gg till svarskommentar
    commentDiv.querySelectorAll(".add-comment-box.reply button").forEach(btn => {
      btn.onclick = async function() {
        const text = commentDiv.querySelector(".add-comment-box.reply textarea").value.trim();
        if (!text || !currentUser) return;
        await db.collection("threads").doc(threadId).collection("comments").add({
          text, parent: id, creatorUid: currentUser.uid,
          timestamp: new Date(), reactions: {}
        });
        renderComments(threadId, parentId, container, depth);
      };
    });
    // Redigera/radera kommentar
    commentDiv.querySelectorAll(".edit-btn").forEach(btn => {
      btn.onclick = function() {
        // Kan l√§gga till edit h√§r!
      };
    });
    commentDiv.querySelectorAll(".delete-btn").forEach(btn => {
      btn.onclick = async function() {
        if (confirm(_( "deleteConfirm"))) {
          await db.collection("threads").doc(threadId).collection("comments").doc(id).delete();
          renderComments(threadId, parentId, container, depth);
        }
      };
    });
    // Barnkommentarer (rekursion)
    renderComments(threadId, id, commentDiv.querySelector(".comments-list"), depth+1);
  });
}

/* ------- S√∂kfunktion (global) ------- */
document.getElementById("globalSearchInput").addEventListener("keydown", function(e) {
  if (e.key === "Enter") {
    const query = this.value.trim();
    if (query) window.location.href = "search.html?q=" + encodeURIComponent(query);
  }
});

/* ------- Hamburgermeny centrering ------- */
const menuBtn = document.getElementById("menuBtn");
const navLinks = document.getElementById("navLinks");
menuBtn.onclick = () => navLinks.classList.toggle("active");
document.querySelectorAll('.nav-content a').forEach(a =>
  a.onclick = () => navLinks.classList.remove("active")
);

/* ------- Spr√•kbyte direkt ------- */
updateLangUI();
window.addEventListener('storage', function(e){
  if(e.key === 'language') {
    lang = localStorage.language === "en" ? "en" : "sv";
    updateLangUI();
    loadThreads();
  }
});
</script>
</body>
</html>
