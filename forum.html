<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forum ‚Äì GhostGrid</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      margin: 0;
      padding-top: 85px;
      background-color: #0a0a0a;
      color: #e0ffff;
      font-family: 'Courier New', monospace;
      min-height: 100vh;
      box-sizing: border-box;
    }
    nav.navbar {
      background: #000;
      width: 100vw;
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 2000;
      border-bottom: 4px solid #ad30fa;
      box-shadow: 0 0 20px #ad30fa;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .nav-content {
      display: flex;
      gap: 40px;
      padding: 14px 0 12px 0;
      align-items: center;
      justify-content: center;
      width: 100%;
      transition: 0.18s;
    }
    .nav-content a {
      color: #e0ffff;
      text-decoration: none;
      font-size: 1.35em;
      font-family: monospace;
      padding: 5px 22px;
      border-radius: 7px;
      margin: 0 5px;
      background: transparent;
      transition: background 0.18s, color 0.18s, box-shadow 0.22s;
      text-shadow: 0 0 8px #ad30fa, 0 0 3px #fff;
    }
    .nav-content a:hover, .nav-content a.active {
      background: #ad30fa;
      color: #000;
      box-shadow: 0 0 16px #ad30fa, 0 0 5px #fff;
    }
    #menuBtn {
      display: none;
      background: none;
      border: none;
      color: #fff;
      font-size: 2.3em;
      position: absolute;
      right: 18px;
      top: 5px;
      cursor: pointer;
      z-index: 3000;
    }
    .ad-side {
      position: fixed;
      top: 98px;
      bottom: 18px;
      width: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 900;
      pointer-events: none;
    }
    .ad-side img {
      width: 110px;
      height: 280px;
      object-fit: cover;
      border-radius: 14px;
      box-shadow: 0 0 12px #ad30fa99;
      margin-top: 10px;
      background: #0f0020;
      pointer-events: auto;
    }
    .ad-left { left: 0; }
    .ad-right { right: 0; }
    @media (max-width: 1000px) {
      .ad-side { display: none !important; }
    }
    @media (max-width: 900px) {
      .nav-content {
        flex-direction: column;
        background: #0a0020f7;
        position: absolute;
        left: 0; top: 55px;
        width: 100vw;
        gap: 18px;
        padding: 15px 0 10px 0;
        display: none;
        z-index: 2000;
      }
      .nav-content.active { display: flex; }
      #menuBtn { display: block; }
    }
    @media (max-width: 600px) {
      .nav-content a { font-size: 1.11em; }
    }
    .forum-container {
      max-width: 900px;
      margin: 0 auto;
      width: 100%;
      display: flex;
      gap: 30px;
      padding: 12px;
    }
    .forum-main {
      flex: 1 1 0;
      min-width: 0;
    }
    .forum-title {
      font-size: 2em;
      text-align: center;
      color: #aaffee;
      margin: 10px 0 22px 0;
      text-shadow: 0 0 8px #ffffff;
    }
    .search-bar {
      display: flex;
      justify-content: center;
      margin-bottom: 15px;
    }
    .search-bar input {
      padding: 8px;
      width: 72vw;
      max-width: 370px;
      border-radius: 6px;
      border: 1px solid #7b00ff;
      background-color: #1a1a1a;
      color: #fff;
      font-size: 1em;
      margin-top: 2px;
      margin-bottom: 2px;
      text-align: center;
    }
    .new-category-form {
      margin: 32px 0 0 0;
      padding: 18px 10px 12px 10px;
      border: 2px dashed #00ffcc;
      border-radius: 10px;
      background-color: rgba(255,255,255,0.02);
      max-width: 520px;
      margin-left: auto;
      margin-right: auto;
      box-sizing: border-box;
      overflow: hidden;
    }
    .new-category-form input,
    .new-category-form textarea {
      width: 94%;
      margin-bottom: 10px;
      border-radius: 6px;
      border: 1px solid #00ffcc;
      background-color: #111;
      color: #00ffcc;
      font-family: 'Courier New', monospace;
      box-sizing: border-box;
      padding: 10px;
    }
    .new-category-form button {
      background-color: #00ffcc;
      color: #000;
      border: none;
      padding: 10px 20px;
      font-size: 1em;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .forum-sidebar {
      width: 260px;
      min-width: 170px;
      background-color: rgba(0,0,0,0.88);
      border-left: 2px solid #00ffcc;
      padding: 22px 18px 18px 18px;
      border-radius: 10px;
      height: fit-content;
      box-shadow: 0 0 12px #11111166;
      margin-top: 10px;
    }
    .forum-sidebar h3 {
      margin-top: 0;
      color: #00ffcc;
      font-size: 1.15em;
      letter-spacing: 1px;
    }
    /* --- AI-assistenter --- */
    .ai-section {
      margin: 28px 0 0 0;
      padding: 14px 10px 14px 10px;
      border-radius: 14px;
      background: linear-gradient(90deg, #151a23 80%, #201d29 100%);
      box-shadow: 0 0 18px #00ffcc44;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    .ai-icons-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 32px;
      margin-bottom: 10px;
      margin-top: 6px;
    }
    .ai-avatar {
      text-align: center;
      flex: 1 1 0;
      cursor: pointer;
      transition: transform 0.13s;
    }
    .ai-label {
      font-weight: bold;
      color: #00ffcc;
      letter-spacing: 1px;
      font-size: 1.07em;
      margin-top: 5px;
    }
    .ai-desc {
      color: #b8ffee;
      font-size: 0.99em;
      margin: 0 0 3px 0;
      text-align: center;
    }
    /* Popup */
    .popup-bg {
      position: fixed;
      left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.7);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .popup-dialog {
      background: #18192a;
      color: #fff;
      border-radius: 14px;
      box-shadow: 0 0 24px #00ffcc66;
      padding: 34px 38px 26px 38px;
      min-width: 220px;
      text-align: center;
    }
    .popup-dialog button {
      margin: 22px 16px 0 16px;
      padding: 6px 20px;
      font-size: 1.07em;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 0 4px #00ffcc77;
      background: #00ffcc;
      color: #18192a;
      transition: background 0.16s, color 0.16s;
    }
    .popup-dialog .no-btn {
      background: #111;
      color: #ccc;
      box-shadow: none;
      border: 1px solid #aaa;
    }
  </style>
  <!-- FIREBASE SETUP -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCR8q40Dc4wcfYBDlxdpOriA2e3RTmAesg",
      authDomain: "ghostgrid-fb278.firebaseapp.com",
      projectId: "ghostgrid-fb278",
      storageBucket: "ghostgrid-fb278.appspot.com",
      messagingSenderId: "283208202937",
      appId: "1:283208202937:web:11c0cea81fd81a31163968",
      measurementId: "G-B0WCKJCNT9"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
  </script>
</head>
<body>
  <!-- SIDREKLAMER -->
  <div class="ad-side ad-left">
    <img src="https://dummyimage.com/110x280/7b00ff/fff&text=Reklam+V√§nster" alt="Reklam v√§nster">
  </div>
  <div class="ad-side ad-right">
    <img src="https://dummyimage.com/110x280/00ffcc/222&text=Reklam+H√∂ger" alt="Reklam h√∂ger">
  </div>

  <nav class="navbar">
    <div class="nav-content" id="navLinks">
      <a href="forum.html">Forum</a>
      <a href="store.html">Store</a>
      <a href="wall.html">V√§ggen</a>
      <a href="upload.html">Ladda upp</a>
      <a href="profile.html">Profil</a>
      <a href="friends.html">V√§nner</a>
      <div class="search-container">
        <input type="text" id="globalSearchInput" placeholder="S√∂k p√• hela sidan...">
      </div>
    </div>
    <button id="menuBtn" aria-label="Meny">&#9776;</button>
  </nav>

  <div class="forum-container">
    <div class="forum-main">
      <h1 class="forum-title" id="forumTitle">Forum</h1>
      <div class="search-bar">
        <input type="text" id="forumSearchInput" placeholder="S√∂k forumtr√•dar eller kategorier...">
      </div>
      <div id="categoriesContainer"></div>
      <div class="new-category-form">
        <h3 id="createCatTitle">Skapa ny kategori</h3>
        <input type="text" id="newCategoryTitle" placeholder="Titel">
        <textarea id="newCategoryDescription" rows="3" placeholder="Beskrivning..."></textarea>
        <button onclick="createNewCategory()" id="addCatBtn">L√§gg till kategori</button>
      </div>
    </div>
    <div class="forum-sidebar">
      <h3>Info</h3>
      <p id="welcomeText">V√§lkommen till GhostGrid Forum. H√§r hittar du olika kategorier f√∂r att dela tankar, fr√•gor och projekt.</p>
      <p id="tipsText">üí¨ Tips: Anv√§nd globala s√∂kfunktionen f√∂r att hitta tr√•dar √∂ver hela plattformen.</p>
      <div class="ai-section">
        <div style="text-align:center; color:#bbfffa; font-weight:bold; margin-bottom:8px; font-size:1.07em;">
          <span id="aiIntro">Tr√§ffa v√•ra AI-assistenter</span>
        </div>
        <div class="ai-icons-row">
          <div class="ai-avatar">
            <a href="ghost.html" style="text-decoration:none; color:inherit;">
              <svg width="56" height="56" viewBox="0 0 56 56" fill="none">
                <ellipse cx="28" cy="32" rx="16" ry="19" fill="#131b20" stroke="#00ffcc" stroke-width="3"/>
                <ellipse cx="22" cy="32" rx="3.5" ry="3" fill="#fff"/>
                <ellipse cx="34" cy="32" rx="3.5" ry="3" fill="#fff"/>
                <rect x="19.5" y="39" width="17" height="6" rx="3" fill="#232d38"/>
                <rect x="15.5" y="26" width="25" height="11" rx="11" fill="none" stroke="#00ffcc" stroke-width="1"/>
              </svg>
              <div class="ai-label">Ghost</div>
            </a>
            <div class="ai-desc" id="ghostDesc">
              Din tekniska guide och informat√∂r.<br>
              <span style="color:#00ffcc;">Klicka f√∂r att chatta med Ghost!</span>
            </div>
          </div>
          <div class="ai-avatar">
            <a href="glow.html" style="text-decoration:none; color:inherit;">
              <svg width="56" height="56" viewBox="0 0 64 64" fill="none">
                <ellipse cx="32" cy="36" rx="14" ry="16" fill="#fffbe8" stroke="#ffe700" stroke-width="2"/>
                <path d="M26 44 Q32 48 38 44" stroke="#ffcc1a" stroke-width="2" fill="none"/>
                <ellipse cx="27" cy="36" rx="2" ry="2.5" fill="#555"/>
                <ellipse cx="37" cy="36" rx="2" ry="2.5" fill="#555"/>
                <g>
                  <circle cx="14" cy="28" r="2" fill="#ffe700" opacity="0.7"/>
                  <circle cx="48" cy="20" r="1.7" fill="#ffed60" opacity="0.5"/>
                  <circle cx="52" cy="40" r="1.3" fill="#fff780" opacity="0.7"/>
                  <circle cx="36" cy="17" r="1.1" fill="#fffbc0" opacity="0.6"/>
                  <circle cx="18" cy="50" r="1.2" fill="#fffdd2" opacity="0.5"/>
                  <circle cx="28" cy="14" r="1.3" fill="#fff780" opacity="0.7"/>
                </g>
              </svg>
              <div class="ai-label">Glow</div>
            </a>
            <div class="ai-desc" id="glowDesc">
              Din positiva och st√∂ttande v√§n.<br>
              <span style="color:#ffe700;">Klicka f√∂r att chatta med Glow!</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Popup f√∂r bekr√§ftelse vid radering -->
  <div id="deletePopup" class="popup-bg" style="display:none;">
    <div class="popup-dialog">
      <div id="deletePopupText" style="font-size:1.11em; margin-bottom:8px;"></div>
      <button id="popupYesBtn">Ja / Yes</button>
      <button id="popupNoBtn" class="no-btn">Nej / No</button>
    </div>
  </div>

  <!-- Hamburgermeny JS -->
  <script>
    const menuBtn = document.getElementById("menuBtn");
    const navLinks = document.getElementById("navLinks");
    menuBtn.onclick = () => navLinks.classList.toggle("active");
    document.querySelectorAll('.nav-content a').forEach(a =>
      a.onclick = () => navLinks.classList.remove("active")
    );
  </script>

  <!-- All din forumfunktionalitet JS -->
  <script>
    // --- Spr√•kst√∂d ---
    const translations = {
      sv: {
        forumTitle: "Forum",
        createCatTitle: "Skapa ny kategori",
        newCatPlaceholder: "Titel",
        newDescPlaceholder: "Beskrivning...",
        addCatBtn: "L√§gg till kategori",
        welcomeText: "V√§lkommen till GhostGrid Forum. H√§r hittar du olika kategorier f√∂r att dela tankar, fr√•gor och projekt.",
        tipsText: "üí¨ Tips: Anv√§nd globala s√∂kfunktionen f√∂r att hitta tr√•dar √∂ver hela plattformen.",
        aiIntro: "Tr√§ffa v√•ra AI-assistenter",
        ghostDesc: "Din tekniska guide och informat√∂r.<br><span style='color:#00ffcc;'>Klicka f√∂r att chatta med Ghost!</span>",
        glowDesc: "Din positiva och st√∂ttande v√§n.<br><span style='color:#ffe700;'>Klicka f√∂r att chatta med Glow!</span>",
        deleteQuestion: "√Ñr du s√§ker p√• att du vill ta bort denna kategori?",
        yes: "Ja",
        no: "Nej",
        onlyOwnDelete: "Du kan bara ta bort dina egna kategorier!",
        fillAllFields: "Fyll i alla f√§lt!",
        addSuccess: "Ny kategori tillagd!",
        errorGeneric: "Ett fel uppstod. F√∂rs√∂k igen.",
        needLogin: "Du m√•ste vara inloggad f√∂r att skapa, reagera eller ta bort."
      },
      en: {
        forumTitle: "Forum",
        createCatTitle: "Create New Category",
        newCatPlaceholder: "Title",
        newDescPlaceholder: "Description...",
        addCatBtn: "Add Category",
        welcomeText: "Welcome to GhostGrid Forum. Here you find different categories to share thoughts, questions, and projects.",
        tipsText: "üí¨ Tip: Use the global search to find threads across the platform.",
        aiIntro: "Meet our AI assistants",
        ghostDesc: "Your technical guide and information source.<br><span style='color:#00ffcc;'>Click to chat with Ghost!</span>",
        glowDesc: "Your positive and supportive friend.<br><span style='color:#ffe700;'>Click to chat with Glow!</span>",
        deleteQuestion: "Are you sure you want to delete this category?",
        yes: "Yes",
        no: "No",
        onlyOwnDelete: "You can only delete your own categories!",
        fillAllFields: "Fill in all fields!",
        addSuccess: "New category added!",
        errorGeneric: "An error occurred. Please try again.",
        needLogin: "You need to be logged in to create, react, or delete."
      }
    };

    let lang = localStorage.language === "en" ? "en" : "sv";

    function updateLangUI() {
      document.getElementById("forumTitle").textContent = translations[lang].forumTitle;
      document.getElementById("createCatTitle").textContent = translations[lang].createCatTitle;
      document.getElementById("newCategoryTitle").placeholder = translations[lang].newCatPlaceholder;
      document.getElementById("newCategoryDescription").placeholder = translations[lang].newDescPlaceholder;
      document.getElementById("addCatBtn").textContent = translations[lang].addCatBtn;
      document.getElementById("welcomeText").textContent = translations[lang].welcomeText;
      document.getElementById("tipsText").textContent = translations[lang].tipsText;
      document.getElementById("aiIntro").textContent = translations[lang].aiIntro;
      document.getElementById("ghostDesc").innerHTML = translations[lang].ghostDesc;
      document.getElementById("glowDesc").innerHTML = translations[lang].glowDesc;
    }
    updateLangUI();

    // --- Emoji-reaktioner ---
    const REACTIONS = [
      { emoji: "üëç", key: "thumbsup" },
      { emoji: "üëé", key: "thumbsdown" },
      { emoji: "üôÇ", key: "smile" },
      { emoji: "üòÉ", key: "bigsmile" },
      { emoji: "üòÇ", key: "laugh" },
      { emoji: "üòï", key: "confused" },
      { emoji: "üôÅ", key: "sad" },
      { emoji: "üò¢", key: "cry" },
      { emoji: "üò°", key: "angry" },
      { emoji: "üò≥", key: "embarrassed" },
      { emoji: "üòá", key: "angel" }
    ];

    let currentUser = null;

    auth.onAuthStateChanged(user => {
      currentUser = user;
      loadCategories();
    });

    // --- Ladda och rendera kategorier ---
    async function loadCategories() {
      const container = document.getElementById("categoriesContainer");
      container.innerHTML = "";
      const query = await db.collection("forumCategories").orderBy("timestamp").get();
      query.forEach(doc => {
        const data = doc.data();
        const id = doc.id;
        const reactions = data.reactions || {};
        const counts = {};
        for (const uid in reactions) {
          const reaction = reactions[uid];
          counts[reaction] = (counts[reaction] || 0) + 1;
        }
        const div = document.createElement("div");
        div.className = "forum-category";
        div.innerHTML = `
          <div class="category-title">${data.title}</div>
          <div class="category-description">${data.description}</div>
          <div class="reactions-bar">
            ${REACTIONS.map(r => `
              <button class="reaction-btn${reactions[currentUser?.uid] === r.key ? " selected" : ""}" 
                data-cat="${id}" data-reaction="${r.key}" title="${r.emoji}">
                ${r.emoji}<span class="reaction-count">${counts[r.key] ? counts[r.key] : ""}</span>
              </button>
            `).join("")}
            ${currentUser && data.creatorUid === currentUser.uid
              ? `<button class="delete-btn" data-cat="${id}">${lang === "en" ? "Delete" : "Ta bort"}</button>`
              : ""}
          </div>
        `;
        container.appendChild(div);
      });
      document.querySelectorAll(".reaction-btn").forEach(btn => {
        btn.onclick = async function() {
          if (!currentUser) return alert(translations[lang].needLogin);
          const catId = this.getAttribute("data-cat");
          const reaction = this.getAttribute("data-reaction");
          const catRef = db.collection("forumCategories").doc(catId);
          const snap = await catRef.get();
          const data = snap.data();
          let reactions = data.reactions || {};
          if (reactions[currentUser.uid] === reaction) {
            delete reactions[currentUser.uid];
          } else {
            reactions[currentUser.uid] = reaction;
          }
          await catRef.update({ reactions });
          loadCategories();
        };
      });
      document.querySelectorAll(".delete-btn").forEach(btn => {
        btn.onclick = function() {
          showDeletePopup(btn.getAttribute("data-cat"));
        };
      });
    }

    // --- Skapa ny kategori ---
    async function createNewCategory() {
      if (!currentUser) {
        alert(translations[lang].needLogin);
        return;
      }
      const title = document.getElementById("newCategoryTitle").value.trim();
      const desc = document.getElementById("newCategoryDescription").value.trim();
      if (!title || !desc) {
        alert(translations[lang].fillAllFields);
        return;
      }
      try {
        await db.collection("forumCategories").add({
          title,
          description: desc,
          creatorUid: currentUser.uid,
          timestamp: new Date(),
          reactions: {}
        });
        alert(translations[lang].addSuccess);
        document.getElementById("newCategoryTitle").value = "";
        document.getElementById("newCategoryDescription").value = "";
        loadCategories();
      } catch (e) {
        alert(translations[lang].errorGeneric);
      }
    }

    // --- Popup f√∂r borttagning ---
    let deleteCatId = null;
    function showDeletePopup(catId) {
      deleteCatId = catId;
      document.getElementById("deletePopupText").textContent = translations[lang].deleteQuestion;
      document.getElementById("deletePopup").style.display = "flex";
    }
    document.getElementById("popupYesBtn").onclick = async function() {
      if (deleteCatId) {
        await db.collection("forumCategories").doc(deleteCatId).delete();
        loadCategories();
        document.getElementById("deletePopup").style.display = "none";
        deleteCatId = null;
      }
    };
    document.getElementById("popupNoBtn").onclick = function() {
      document.getElementById("deletePopup").style.display = "none";
      deleteCatId = null;
    };

    // --- S√∂kfunktion (lokal p√• sidan) ---
    document.getElementById("forumSearchInput").addEventListener("input", function() {
      const val = this.value.toLowerCase();
      document.querySelectorAll('.forum-category').forEach(cat => {
        const text = cat.innerText.toLowerCase();
        cat.style.display = (!val || text.includes(val)) ? "" : "none";
      });
    });

    // --- Global s√∂kning ---
    document.getElementById("globalSearchInput").addEventListener("keydown", function(e) {
      if (e.key === "Enter") {
        const query = this.value.trim();
        if (query) {
          window.location.href = "search.html?q=" + encodeURIComponent(query);
        }
      }
    });

    // --- Navbar g√∂ms vid scroll p√• mobil ---
    if (window.innerWidth <= 600) {
      let lastScrollY = window.scrollY;
      let navbar = document.querySelector('.navbar');
      window.addEventListener('scroll', function () {
        if (window.scrollY > lastScrollY && window.scrollY > 70) {
          navbar.classList.add('hide-navbar');
        } else {
          navbar.classList.remove('hide-navbar');
        }
        lastScrollY = window.scrollY;
      });
    }

    // --- Byt spr√•k om localStorage.language √§ndras ---
    window.addEventListener('storage', function(e){
      if(e.key === 'language') {
        lang = localStorage.language === "en" ? "en" : "sv";
        updateLangUI();
        loadCategories();
      }
    });

    // --- Ladda kategorier direkt om ej inloggad ---
    if (!currentUser) loadCategories();
  </script>
</body>
</html>
