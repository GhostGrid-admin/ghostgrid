<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GhostGrid ‚Äì Ladda upp</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* ... (All din CSS fr√•n tidigare, exakt samma, inget borttaget!) ... */
    /* [Inkludera g√§rna din befintliga CSS h√§r] */
    body { background: #0a0a0a; color: #e0ffff; font-family: 'Courier New', monospace; min-height: 100vh; margin: 0; padding-top: 85px; position: relative; overflow-x: hidden;}
    .glow-left, .glow-right { position: fixed; top: 0; width: 136px; height: 100vh; pointer-events: none; z-index: 0; }
    .glow-left { left: 0; background: radial-gradient(circle at left, #d900ff 0%, #7200ffcc 40%, transparent 85%); box-shadow: 0 0 60px 30px #d900ffbb, 0 0 180px 60px #00ffe0aa, 0 0 320px 90px #9400ff66; }
    .glow-right { right: 0; background: radial-gradient(circle at right, #d900ff 0%, #7200ffcc 40%, transparent 85%); box-shadow: 0 0 60px 30px #d900ffbb, 0 0 180px 60px #00ffe0aa, 0 0 320px 90px #9400ff66; }
    .side-banner { position: fixed; top: 87px; bottom: 0; width: 136px; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; z-index: 1002; background: none; pointer-events: none; }
    .side-banner .banner-inner { width: 120px; height: 100%; background: transparent; border-radius: 12px; box-shadow: 0 0 18px #7b00ff99; overflow: hidden; display: flex; flex-direction: column; align-items: center; pointer-events: auto; }
    .side-banner img { width: 100%; height: 100%; object-fit: cover; border-radius: 10px; background: #220043; cursor: pointer; transition: box-shadow 0.3s; box-shadow: 0 0 10px #8800ff70; pointer-events: auto; min-height: 200px; }
    .side-banner.left { left: 0; } .side-banner.right { right: 0; }
    @media (max-width: 1100px) { .side-banner, .glow-left, .glow-right { width: 65px; } .side-banner .banner-inner { width: 57px; } }
    @media (max-width: 700px) { .side-banner { display: none; } }
    nav.navbar { background-color: #000; border-bottom: 2px solid #00ffcc; padding: 12px 0; position: fixed; width: 100%; top: 0; z-index: 1000; box-shadow: 0 0 20px #bb00ff; display: flex; justify-content: center; transition: top 0.3s;}
    .nav-content { display: flex; justify-content: center; flex-wrap: wrap; gap: 16px; max-width: 900px; width: 100%; align-items: center; text-align: center; }
    .nav-content a { color: white; text-decoration: none; font-size: 1.2em; padding: 7px 10px; border-radius: 4px; text-shadow: 0 0 8px #00ffcc, 0 0 6px #bb00ff; transition: 0.3s;}
    .nav-content a:hover { background-color: #00ffcc; color: #000; box-shadow: 0 0 10px #ffffff; }
    .hamburger { display: none; flex-direction: column; justify-content: center; cursor: pointer; margin-left: 10px; }
    .hamburger span { width: 29px; height: 4px; background: #00ffcc; margin: 4px 0; border-radius: 2px; transition: 0.3s;}
    @media (max-width: 700px) {
      .nav-content { display: none; flex-direction: column; position: fixed; left: 0; right: 0; top: 58px; background: #181f26; box-shadow: 0 4px 28px #00ffcc77; z-index: 1101; padding-bottom: 20px; gap: 0; }
      .nav-content.show { display: flex; }
      .nav-content a { padding: 18px 10px; font-size: 1.15em; width: 100vw; border-radius: 0; text-align: center; border-bottom: 1px solid #3fffd966;}
      .hamburger { display: flex; }
    }
    .upload-box { border: 2px solid #66ffcc; border-radius: 12px; padding: 30px 20px 22px 20px; margin: 36px auto 32px auto; max-width: 440px; background-color: rgba(0, 0, 0, 0.88); box-shadow: 0 0 15px #00ffcc33; position: relative; z-index: 2; min-width: 0;}
    .upload-title { font-size: 2.6em; text-align: center; color: #f5f5f5; margin: 16px 0 28px 0; text-shadow: 0 2px 12px #222, 0 1px 0 #fff; font-weight: bold; letter-spacing: 0.04em;}
    .upload-switcher { display: flex; gap: 10px; justify-content: center; margin-bottom: 22px; flex-wrap: wrap;}
    .switch-btn { background: #111; color: #80ffcc; border: 1px solid #66ffcc; border-radius: 5px; padding: 6px 14px; font-size: 1em; cursor: pointer; transition: 0.18s; font-family: 'Courier New', monospace;}
    .switch-btn.active, .switch-btn:hover { background: #00ffcc; color: #000; font-weight: bold; box-shadow: 0 0 8px #00ffcc;}
    textarea, input[type="file"], button[type="submit"], label { display: block; width: 100%; margin-top: 1rem; font-family: inherit; font-size: 1rem; color: #b8f6ff; background-color: #111; border: 1px solid #66ffcc; padding: 0.6rem; border-radius: 6px; box-sizing: border-box;}
    label {margin-bottom: -0.7rem;}
    button[type="submit"] { background-color: #00ffcc; color: #000; font-weight: bold; cursor: pointer;}
    button[type="submit"]:hover { background-color: #00ccaa; }
    #spinner { display: none; width: 50px; margin: 10px auto;}
    audio { margin-top: 10px; }
    .upload-section { display: none; }
    .upload-section.active { display: block; }
    .desc-section { margin-top: -7px; }
    .logout-btn {
      position: absolute; right: 22px; top: 13px; background: #171f2a; border: 1.5px solid #00ffcc; color: #fff;
      border-radius: 6px; font-size: 1.02em; padding: 6px 19px; font-family: inherit; font-weight: bold; cursor: pointer;
      transition: background .18s, color .18s; z-index: 2002; box-shadow: 0 0 13px #00ffcc20;
    }
    .logout-btn:hover { background: #00ffcc; color: #19191b; }
  </style>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
  <script>
    // Firebase konfiguration
    const firebaseConfig = {
      apiKey: "AIzaSyCR8q40Dc4wcfYBDlxdpOriA2e3RTmAesg",
      authDomain: "ghostgrid-fb278.firebaseapp.com",
      projectId: "ghostgrid-fb278",
      storageBucket: "ghostgrid-fb278.appspot.com",
      messagingSenderId: "283208202937",
      appId: "1:283208202937:web:11c0cea81fd81a31163968",
      measurementId: "G-B0WCKJCNT9"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();
  </script>
</head>
<body>
  <div class="glow-left"></div>
  <div class="glow-right"></div>
  <div class="side-banner left"><div class="banner-inner">
    <a id="leftBannerLink" href="#" target="_blank">
      <img id="leftBannerImg" src="https://dummyimage.com/120x1800/7b00ff/fff&text=Reklam+1" alt="Reklam" />
    </a>
  </div></div>
  <div class="side-banner right"><div class="banner-inner">
    <a id="rightBannerLink" href="#" target="_blank">
      <img id="rightBannerImg" src="https://dummyimage.com/120x1800/222299/fff&text=Reklam+2" alt="Reklam" />
    </a>
  </div></div>
  <nav class="navbar">
    <div class="hamburger" id="hamburgerBtn" aria-label="Meny" tabindex="0">
      <span></span><span></span><span></span>
    </div>
    <div class="nav-content" id="navMenu">
      <a href="forum.html" data-i18n="forum">Forum</a>
      <a href="wall.html" data-i18n="wall">V√§ggen</a>
      <a href="upload.html" data-i18n="upload">Ladda upp</a>
      <a href="profile.html" data-i18n="profile">Profil</a>
      <a href="friends.html" data-i18n="friends">V√§nner</a>
      <a href="ghostglow.html" data-i18n="ghostglow">Ghost&Glow</a>
      <a href="store.html" data-i18n="store">Butik</a>
    </div>
    <button class="logout-btn" id="logoutBtn" style="display:none;">Logga ut</button>
  </nav>
  <div class="upload-box" id="uploadBox">
    <div class="upload-title" id="uploadTitle">Ladda upp inneh√•ll</div>
    <img id="spinner" src="spinner-asg.png" alt="Laddar..." />
    <div class="upload-switcher" id="switcher">
      <button class="switch-btn active" data-section="text" id="textBtn">üìù Inl√§gg</button>
      <button class="switch-btn" data-section="image" id="imageBtn">üñºÔ∏è Bild</button>
      <button class="switch-btn" data-section="video" id="videoBtn">üé¨ Klipp</button>
      <button class="switch-btn" data-section="audio" id="audioBtn">üéµ Ljud</button>
      <button class="switch-btn" data-section="mic" id="micBtn">üé§ R√∂st</button>
    </div>
    <form id="uploadForm">
      <!-- TEXT -->
      <div class="upload-section active" data-section="text" id="section-text">
        <label for="text" id="label-text">Skriv ett inl√§gg:</label>
        <textarea id="text" placeholder="Vad vill du dela med dig av?" maxlength="1500"></textarea>
      </div>
      <!-- BILD -->
      <div class="upload-section" data-section="image" id="section-image">
        <label for="image" id="label-image">Ladda upp en bild (max 5 MB):</label>
        <input type="file" id="image" accept="image/*" />
        <div class="desc-section">
          <label for="imageDesc" id="label-image-desc">Beskrivning:</label>
          <input type="text" id="imageDesc" maxlength="140" placeholder="Beskriv inneh√•llet..." />
        </div>
      </div>
      <!-- VIDEO -->
      <div class="upload-section" data-section="video" id="section-video">
        <label for="video" id="label-video">Ladda upp ett klipp (max 30 MB):</label>
        <input type="file" id="video" accept="video/mp4,video/webm,video/ogg" />
        <div class="desc-section">
          <label for="videoDesc" id="label-video-desc">Beskrivning:</label>
          <input type="text" id="videoDesc" maxlength="140" placeholder="Beskriv inneh√•llet..." />
        </div>
      </div>
      <!-- AUDIO -->
      <div class="upload-section" data-section="audio" id="section-audio">
        <label for="audio" id="label-audio">Ladda upp ljudfil (max 5 MB):</label>
        <input type="file" id="audio" accept="audio/*" />
        <div class="desc-section">
          <label for="audioDesc" id="label-audio-desc">Beskrivning:</label>
          <input type="text" id="audioDesc" maxlength="140" placeholder="Beskriv inneh√•llet..." />
        </div>
      </div>
      <!-- R√ñSTINSPELNING -->
      <div class="upload-section" data-section="mic" id="section-mic">
        <label id="label-mic">Mikrofoninspelning (max 2 MB):</label>
        <button type="button" id="recordButton">üé§ Starta inspelning</button>
        <button type="button" id="stopButton" disabled>üõë Stoppa</button>
        <audio id="audioPreview" controls></audio>
        <div class="desc-section">
          <label for="micDesc" id="label-mic-desc">Beskrivning:</label>
          <input type="text" id="micDesc" maxlength="140" placeholder="Beskriv inneh√•llet..." />
        </div>
      </div>
      <label style="margin-top:18px;">
        <input type="checkbox" id="temporary" />
        <span id="label-temporary">G√∂r detta till ett tillf√§lligt inl√§gg (f√∂rsvinner om 24h)</span>
      </label>
      <button type="submit" style="margin-top:18px;" id="uploadBtn">Ladda upp</button>
    </form>
  </div>
  <script>
    // Banner-rotation
    const banners = [
      { left: { src: "https://dummyimage.com/120x1800/7b00ff/fff&text=Reklam+1", alt: "Reklam Banner 1", url: "#" }, right: { src: "https://dummyimage.com/120x1800/222299/fff&text=Reklam+2", alt: "Reklam Banner 2", url: "#" }},
      { left: { src: "https://dummyimage.com/120x1800/ff0088/fff&text=Bli+medlem!", alt: "Bli medlem", url: "register.html" }, right: { src: "https://dummyimage.com/120x1800/0077ff/fff&text=Annonsera+H√§r", alt: "Annonsera", url: "#" }}
    ];
    let bannerIndex = 0;
    function updateBanners() {
      const left = banners[bannerIndex].left, right = banners[bannerIndex].right;
      document.getElementById('leftBannerImg').src = left.src; document.getElementById('leftBannerImg').alt = left.alt; document.getElementById('leftBannerLink').href = left.url;
      document.getElementById('rightBannerImg').src = right.src; document.getElementById('rightBannerImg').alt = right.alt; document.getElementById('rightBannerLink').href = right.url;
    }
    updateBanners(); setInterval(() => { bannerIndex = (bannerIndex + 1) % banners.length; updateBanners(); }, 6000);

    // Hamburger-meny
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const navMenu = document.getElementById('navMenu');
    hamburgerBtn.addEventListener('click', function() { navMenu.classList.toggle('show'); });
    navMenu.querySelectorAll('a').forEach(link => { link.addEventListener('click', () => { navMenu.classList.remove('show'); }); });

    // Nav-hide p√• mobil
    if (window.innerWidth <= 600) {
      let lastScrollY = window.scrollY;
      let navbar = document.querySelector('.navbar');
      window.addEventListener('scroll', function () {
        if (window.scrollY > lastScrollY && window.scrollY > 70) { navbar.classList.add('hide-navbar'); } else { navbar.classList.remove('hide-navbar'); }
        lastScrollY = window.scrollY;
      });
    }

    // --------- SPR√ÖK ---------
    const translations = {
      sv: {
        uploadTitle: "Ladda upp inneh√•ll",
        forum: "Forum", wall: "V√§ggen", upload: "Ladda upp", profile: "Profil", friends: "V√§nner", ghostglow: "Ghost&Glow", store: "Butik",
        textBtn: "üìù Inl√§gg", imageBtn: "üñºÔ∏è Bild", videoBtn: "üé¨ Klipp", audioBtn: "üéµ Ljud", micBtn: "üé§ R√∂st",
        labelText: "Skriv ett inl√§gg:", labelImage: "Ladda upp en bild (max 5 MB):", labelVideo: "Ladda upp ett klipp (max 30 MB):",
        labelAudio: "Ladda upp ljudfil (max 5 MB):", labelMic: "Mikrofoninspelning (max 2 MB):",
        labelImageDesc: "Beskrivning:", labelVideoDesc: "Beskrivning:", labelAudioDesc: "Beskrivning:", labelMicDesc: "Beskrivning:",
        placeholderText: "Vad vill du dela med dig av?", placeholderDesc: "Beskriv inneh√•llet...",
        temporary: "G√∂r detta till ett tillf√§lligt inl√§gg (f√∂rsvinner om 24h)",
        uploadBtn: "Ladda upp", logout: "Logga ut"
      },
      en: {
        uploadTitle: "Upload content",
        forum: "Forum", wall: "Wall", upload: "Upload", profile: "Profile", friends: "Friends", ghostglow: "Ghost&Glow", store: "Store",
        textBtn: "üìù Post", imageBtn: "üñºÔ∏è Image", videoBtn: "üé¨ Clip", audioBtn: "üéµ Audio", micBtn: "üé§ Voice",
        labelText: "Write a post:", labelImage: "Upload an image (max 5 MB):", labelVideo: "Upload a clip (max 30 MB):",
        labelAudio: "Upload audio file (max 5 MB):", labelMic: "Voice recording (max 2 MB):",
        labelImageDesc: "Description:", labelVideoDesc: "Description:", labelAudioDesc: "Description:", labelMicDesc: "Description:",
        placeholderText: "What do you want to share?", placeholderDesc: "Describe the content...",
        temporary: "Make this a temporary post (disappears after 24h)",
        uploadBtn: "Upload", logout: "Log out"
      }
    };
    function t(key) {
      const lang = (localStorage.lang === "en") ? "en" : "sv";
      return translations[lang][key] || "";
    }
    function applyTranslations() {
      document.getElementById("uploadTitle").textContent = t("uploadTitle");
      document.getElementById("textBtn").textContent = t("textBtn");
      document.getElementById("imageBtn").textContent = t("imageBtn");
      document.getElementById("videoBtn").textContent = t("videoBtn");
      document.getElementById("audioBtn").textContent = t("audioBtn");
      document.getElementById("micBtn").textContent = t("micBtn");
      document.getElementById("label-text").textContent = t("labelText");
      document.getElementById("label-image").textContent = t("labelImage");
      document.getElementById("label-video").textContent = t("labelVideo");
      document.getElementById("label-audio").textContent = t("labelAudio");
      document.getElementById("label-mic").textContent = t("labelMic");
      document.getElementById("label-image-desc").textContent = t("labelImageDesc");
      document.getElementById("label-video-desc").textContent = t("labelVideoDesc");
      document.getElementById("label-audio-desc").textContent = t("labelAudioDesc");
      document.getElementById("label-mic-desc").textContent = t("labelMicDesc");
      document.getElementById("text").placeholder = t("placeholderText");
      document.getElementById("imageDesc").placeholder = t("placeholderDesc");
      document.getElementById("videoDesc").placeholder = t("placeholderDesc");
      document.getElementById("audioDesc").placeholder = t("placeholderDesc");
      document.getElementById("micDesc").placeholder = t("placeholderDesc");
      document.getElementById("label-temporary").textContent = t("temporary");
      document.getElementById("uploadBtn").textContent = t("uploadBtn");
      // Navbar
      document.querySelectorAll("[data-i18n]").forEach(el => { el.textContent = t(el.getAttribute("data-i18n")); });
      document.getElementById("logoutBtn").textContent = t("logout");
    }
    document.addEventListener("DOMContentLoaded", applyTranslations);
    if (localStorage.lang === "en") document.documentElement.lang = "en";

    // --------- V√ÑXLA MELLAN KATEGORIER ---------
    document.querySelectorAll('.switch-btn').forEach(btn => {
      btn.addEventListener('click', function () {
        document.querySelectorAll('.switch-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        let section = this.getAttribute('data-section');
        document.querySelectorAll('.upload-section').forEach(sec => {
          sec.classList.remove('active');
          if (sec.getAttribute('data-section') === section) sec.classList.add('active');
        });
      });
    });

    // --------- LOGGA UT-KNAPP ---------
    const logoutBtn = document.getElementById("logoutBtn");
    auth.onAuthStateChanged(user => {
      logoutBtn.style.display = user ? "block" : "none";
    });
    logoutBtn.onclick = () => {
      auth.signOut().then(() => window.location.href = "login.html");
    };

    // --------- FIREBASE UPLOAD LOGIK ---------
    const MAX_IMAGE_SIZE = 5 * 1024 * 1024;
    const MAX_VIDEO_SIZE = 30 * 1024 * 1024;
    const MAX_AUDIO_SIZE = 5 * 1024 * 1024;
    const MAX_MIC_SIZE = 2 * 1024 * 1024;
    const uploadForm = document.getElementById("uploadForm");
    const spinner = document.getElementById("spinner");
    const uploadBox = document.getElementById("uploadBox");

    // D√∂lj uppladdningsformul√§r om inte inloggad
    auth.onAuthStateChanged(user => {
      if (!user) {
        uploadBox.innerHTML = `<div style="text-align:center;padding:36px 0;font-size:1.23em;color:#ff7788;">
            Du m√•ste vara inloggad f√∂r att ladda upp inneh√•ll.<br><br>
            <a href="login.html" style="color:#00ffcc;font-weight:bold;">Logga in h√§r</a>
          </div>`;
      }
    });

    uploadForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!auth.currentUser) {
        alert("Du m√•ste vara inloggad f√∂r att ladda upp.");
        return;
      }
      spinner.style.display = "block";
      const activeSection = document.querySelector('.switch-btn.active').getAttribute('data-section');
      let postData = {
        createdAt: new Date(),
        user: auth.currentUser.uid,
        type: activeSection,
        temporary: document.getElementById("temporary").checked,
        lang: (localStorage.lang === "en") ? "en" : "sv"
      };
      let filesToUpload = [];
      // ENDAST inl√§gg, ingen beskrivning
      if (activeSection === "text") {
        postData.text = document.getElementById("text").value;
      }
      // Bild/klipp/ljud/r√∂st kr√§ver beskrivning
      if (activeSection === "image") {
        const img = document.getElementById("image").files[0];
        if (img && img.size > MAX_IMAGE_SIZE) {
          spinner.style.display = "none";
          return alert(`Bilden √§r f√∂r stor! Maxstorlek: 5 MB.`);
        }
        postData.desc = document.getElementById("imageDesc").value;
        filesToUpload.push({ file: img, key: "imageUrl" });
      }
      if (activeSection === "video") {
        const vid = document.getElementById("video").files[0];
        if (vid && vid.size > MAX_VIDEO_SIZE) {
          spinner.style.display = "none";
          return alert(`Videoklippet √§r f√∂r stort! Maxstorlek: 30 MB.`);
        }
        postData.desc = document.getElementById("videoDesc").value;
        filesToUpload.push({ file: vid, key: "videoUrl" });
      }
      if (activeSection === "audio") {
        const aud = document.getElementById("audio").files[0];
        if (aud && aud.size > MAX_AUDIO_SIZE) {
          spinner.style.display = "none";
          return alert(`Ljudfilen √§r f√∂r stor! Maxstorlek: 5 MB.`);
        }
        postData.desc = document.getElementById("audioDesc").value;
        filesToUpload.push({ file: aud, key: "audioUrl" });
      }
      if (activeSection === "mic") {
        const micBlob = window.lastRecordedAudioBlob;
        if (micBlob && micBlob.size > MAX_MIC_SIZE) {
          spinner.style.display = "none";
          return alert(`R√∂stinspelningen √§r f√∂r stor! Maxstorlek: 2 MB.`);
        }
        postData.desc = document.getElementById("micDesc").value;
        if (micBlob) filesToUpload.push({ file: micBlob, key: "micAudioUrl" });
      }
      // Ladda upp filer (om det finns)
      for (let upload of filesToUpload) {
        if (!upload.file) continue;
        const storageRef = storage.ref(`uploads/${Date.now()}_${upload.file.name}`);
        await storageRef.put(upload.file);
        const url = await storageRef.getDownloadURL();
        postData[upload.key] = url;
      }
      // Spara posten p√• wall
      await db.collection("wall").add(postData);
      spinner.style.display = "none";
      alert("‚úÖ Inl√§gget har laddats upp!");
      uploadForm.reset();
      window.location.href = "wall.html";
    });

    // --- R√∂stinspelning ---
    let mediaRecorder, audioChunks = [];
    const recordBtn = document.getElementById("recordButton");
    const stopBtn = document.getElementById("stopButton");
    const audioPreview = document.getElementById("audioPreview");
    if (recordBtn && stopBtn && audioPreview) {
      recordBtn.onclick = async function () {
        audioChunks = [];
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.start();
        recordBtn.disabled = true;
        stopBtn.disabled = false;
        mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
        mediaRecorder.onstop = () => {
          const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
          window.lastRecordedAudioBlob = audioBlob;
          audioPreview.src = URL.createObjectURL(audioBlob);
          recordBtn.disabled = false;
          stopBtn.disabled = true;
        };
      };
      stopBtn.onclick = function () {
        mediaRecorder && mediaRecorder.stop();
      };
    }
  </script>
</body>
</html>
</html>
