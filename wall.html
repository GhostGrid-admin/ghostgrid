<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="wall_title">GhostGrid ‚Äì V√§ggen</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      background: #0a0a0a;
      color: #e0ffff;
      font-family: 'Courier New', monospace;
      margin: 0; padding: 0;
      min-height: 100vh;
      padding-top: 85px;
      overflow-x: hidden;
    }
    .glow-left, .glow-right {
      position: fixed; top: 0; width: 136px; height: 100vh;
      pointer-events: none; z-index: 0;
    }
    .glow-left { left: 0; background: radial-gradient(circle at left, #d900ff 0%, #7200ffcc 40%, transparent 85%);}
    .glow-right { right: 0; background: radial-gradient(circle at right, #d900ff 0%, #7200ffcc 40%, transparent 85%);}
    @media (max-width: 1100px) {
      .glow-left, .glow-right { width: 65px;}
    }
    @media (max-width: 700px) {
      .glow-left, .glow-right { display: none;}
    }
    .wall-box {
      border: 2px solid #66ffcc;
      border-radius: 12px;
      padding: 30px 20px 22px 20px;
      margin: 36px auto 32px auto;
      max-width: 550px;
      background-color: rgba(0, 0, 0, 0.92);
      box-shadow: 0 0 15px #00ffcc33;
      position: relative;
      z-index: 2;
      min-width: 0;
    }
    .wall-title {
      font-size: 2.4em;
      text-align: center;
      color: #f5f5f5;
      margin: 12px 0 26px 0;
      text-shadow: 0 2px 12px #222, 0 1px 0 #fff;
      font-weight: bold;
      letter-spacing: 0.03em;
    }
    .filter-row {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 18px;
    }
    .filter-btn {
      padding: 7px 16px;
      border-radius: 5px;
      border: 2px solid #00ffcc;
      background: #121e2a;
      color: #00ffcc;
      font-family: inherit;
      font-size: 1em;
      cursor: pointer;
      box-shadow: 0 0 8px #00ffcc66;
      transition: 0.2s;
      margin-bottom: 4px;
    }
    .filter-btn.active,
    .filter-btn:hover {
      background: #00ffcc;
      color: #19191b;
      font-weight: bold;
      box-shadow: 0 0 12px #00ffcc;
    }
    .post-list { width:100%; max-width:550px; margin:24px auto;}
    .post {
      background: #181f26;
      border: 1.5px solid #66ffcc;
      border-radius: 9px;
      box-shadow: 0 0 10px #00ffcc30;
      margin-bottom: 24px;
      padding: 18px 13px;
      color: #e0ffff;
      word-break: break-word;
      overflow: auto;
    }
    .post .post-header { font-size: 1em; color: #00ffd9; margin-bottom: 6px;}
    .post .post-content { font-size: 1.19em;}
    .post .post-time { color: #9df; font-size: 0.91em; margin-top: 6px;}
    .post img, .post video, .post audio { max-width: 100%; border-radius: 7px; margin-top: 7px;}
    @media (max-width: 600px) {
      .wall-box {padding: 14px 3vw 12px 3vw; max-width: 99vw;}
      .wall-title {font-size: 1.4em;}
      .post-list {max-width:99vw;}
    }
    @media (max-width: 700px) {
      .ad-footer { display: none !important; }
    }
  </style>
</head>
<body>
  <div class="glow-left"></div>
  <div class="glow-right"></div>
  <nav class="navbar">
    <div class="hamburger" id="hamburgerBtn" aria-label="Meny" tabindex="0">
      <span></span><span></span><span></span>
    </div>
    <div class="nav-content" id="navMenu">
      <a href="forum.html">Forum</a>
      <a href="store.html">Store</a>
      <a href="wall.html">V√§ggen</a>
      <a href="upload.html">Ladda upp</a>
      <a href="profile.html">Profil</a>
      <a href="friends.html">V√§nner</a>
      <div class="search-container">
        <input type="text" placeholder="S√∂k p√• hela sidan..." id="searchInput" />
      </div>
    </div>
  </nav>
  <div class="wall-box">
    <div class="wall-title" data-i18n="wall_title">V√§ggen</div>
    <div class="filter-row" id="filterRow">
      <button class="filter-btn active" data-type="all" data-i18n="filter_all">Alla</button>
      <button class="filter-btn" data-type="text" data-i18n="filter_text">Inl√§gg</button>
      <button class="filter-btn" data-type="image" data-i18n="filter_image">Bilder</button>
      <button class="filter-btn" data-type="video" data-i18n="filter_video">Klipp</button>
      <button class="filter-btn" data-type="audio" data-i18n="filter_audio">Ljud</button>
      <button class="filter-btn" data-type="mic" data-i18n="filter_mic">R√∂st</button>
    </div>
    <div id="postList" class="post-list"></div>
  </div>
  <footer class="ad-footer" id="adFooter">
    <div class="ad-banner">
      <a href="#" target="_blank">
        <img id="bannerImageLeft" src="https://dummyimage.com/728x90/7b00ff/fff&text=Reklam+1" alt="Reklam v√§nster" />
      </a>
    </div>
    <div class="ad-banner">
      <a href="#" target="_blank">
        <img id="bannerImageRight" src="https://dummyimage.com/728x90/00ffcc/222&text=Reklam+2" alt="Reklam h√∂ger" />
      </a>
    </div>
  </footer>
  <script type="module">
    // --- NAV, banners, s√∂k osv kan ligga h√§r om du har kod f√∂r det ---
    import { db } from "./scripts/firebase-init.js";
    import { collection, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";
    // FILTERLOGIK
    const postList = document.getElementById("postList");
    const filterRow = document.getElementById("filterRow");
    let allPosts = [];
    async function loadWallPosts() {
      postList.innerHTML = "<div style='color:#00ffcc;'>Laddar inl√§gg...</div>";
      const q = query(collection(db, "wall"), orderBy("createdAt", "desc"));
      const snapshot = await getDocs(q);
      allPosts = [];
      snapshot.forEach(doc => {
        allPosts.push({ id: doc.id, ...doc.data() });
      });
      renderPosts("all");
    }
    function renderPosts(type) {
      let posts = allPosts;
      if (type !== "all") posts = allPosts.filter(p => p.type === type);
      if (posts.length === 0) {
        postList.innerHTML = "<div style='color:#aaa;'>Inga inl√§gg hittades.</div>";
        return;
      }
      postList.innerHTML = posts.map(post => {
        let content = "";
        if (post.type === "text") {
          content = `<div class="post-content">${post.text || ""}</div>`;
        } else if (post.type === "image" && post.imageUrl) {
          content = `<img src="${post.imageUrl}" alt="Bild" />`;
        } else if (post.type === "video" && post.videoUrl) {
          content = `<video src="${post.videoUrl}" controls></video>`;
        } else if (post.type === "audio" && post.audioUrl) {
          content = `<audio src="${post.audioUrl}" controls></audio>`;
        } else if (post.type === "mic" && post.micAudioUrl) {
          content = `<audio src="${post.micAudioUrl}" controls></audio>`;
        } else {
          content = `<div style="color:#ff0077;">Ok√§nt format</div>`;
        }
        return `
          <div class="post">
            <div class="post-header">üë§ ${post.user || "Anonym"}</div>
            ${content}
            <div class="post-time">${formatDate(post.createdAt)}</div>
          </div>
        `;
      }).join("");
    }
    filterRow.addEventListener("click", (e) => {
      if (!e.target.classList.contains("filter-btn")) return;
      filterRow.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      e.target.classList.add('active');
      const type = e.target.getAttribute('data-type');
      renderPosts(type);
    });
    function formatDate(ts) {
      if (!ts || !ts.seconds) return "";
      const d = new Date(ts.seconds * 1000);
      return d.toLocaleString(localStorage.getItem("lang") === "en" ? "en-GB" : "sv-SE", {
        dateStyle: "short",
        timeStyle: "short"
      });
    }
    loadWallPosts();
    // --- Spr√•kv√§xling ---
    const translations = {
      sv: {
        wall_title: "V√§ggen",
        filter_all: "Alla",
        filter_text: "Inl√§gg",
        filter_image: "Bilder",
        filter_video: "Klipp",
        filter_audio: "Ljud",
        filter_mic: "R√∂st",
        post_not_found: "Inga inl√§gg hittades.",
        loading: "Laddar inl√§gg..."
      },
      en: {
        wall_title: "Wall",
        filter_all: "All",
        filter_text: "Posts",
        filter_image: "Images",
        filter_video: "Videos",
        filter_audio: "Audio",
        filter_mic: "Voice",
        post_not_found: "No posts found.",
        loading: "Loading posts..."
      }
    };
    function applyTranslations() {
      const lang = localStorage.getItem("lang") || "sv";
      document.title = translations[lang].wall_title + " ‚Äì GhostGrid";
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        if (translations[lang][key]) el.textContent = translations[lang][key];
      });
      // Placeholder f√∂r dynamiska texter (t.ex. laddar och inga inl√§gg)
      if (postList.innerHTML.includes("Laddar") || postList.innerHTML.includes("Loading")) {
        postList.innerHTML = `<div style='color:#00ffcc;'>${translations[lang].loading}</div>`;
      }
      if (postList.innerHTML.includes("Inga inl√§gg hittades.") || postList.innerHTML.includes("No posts found.")) {
        postList.innerHTML = `<div style='color:#aaa;'>${translations[lang].post_not_found}</div>`;
      }
    }
    document.addEventListener("DOMContentLoaded", applyTranslations);
    // Om du byter spr√•k live ‚Äì k√∂r applyTranslations igen!
  </script>
</body>
</html>
