<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GhostGrid ‚Äì V√§ggen</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      background: #0a0a0a;
      color: #e0ffff;
      font-family: 'Courier New', monospace;
      min-height: 100vh;
      margin: 0;
      padding-top: 85px;
      position: relative;
      overflow-x: hidden;
    }
    .glow-left, .glow-right {
      position: fixed;
      top: 0;
      width: 136px;
      height: 100vh;
      pointer-events: none;
      z-index: 0;
    }
    .glow-left {
      left: 0;
      background: radial-gradient(circle at left, #d900ff 0%, #7200ffcc 40%, transparent 85%);
      box-shadow:
        0 0 60px 30px #d900ffbb,
        0 0 180px 60px #00ffe0aa,
        0 0 320px 90px #9400ff66;
    }
    .glow-right {
      right: 0;
      background: radial-gradient(circle at right, #d900ff 0%, #7200ffcc 40%, transparent 85%);
      box-shadow:
        0 0 60px 30px #d900ffbb,
        0 0 180px 60px #00ffe0aa,
        0 0 320px 90px #9400ff66;
    }
    .side-banner {
      position: fixed;
      top: 87px;
      bottom: 0;
      width: 136px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      z-index: 1002;
      background: none;
      pointer-events: none;
    }
    .side-banner .banner-inner {
      width: 120px;
      height: 100%;
      background: transparent;
      border-radius: 12px;
      box-shadow: 0 0 18px #7b00ff99;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      pointer-events: auto;
    }
    .side-banner img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
      background: #220043;
      cursor: pointer;
      transition: box-shadow 0.3s;
      box-shadow: 0 0 10px #8800ff70;
      pointer-events: auto;
      min-height: 200px;
    }
    .side-banner.left { left: 0; }
    .side-banner.right { right: 0; }
    @media (max-width: 1100px) {
      .side-banner, .glow-left, .glow-right { width: 65px; }
      .side-banner .banner-inner { width: 57px; }
    }
    @media (max-width: 700px) {
      .side-banner { display: none; }
    }
    nav.navbar {
      background-color: #000;
      border-bottom: 2px solid #00ffcc;
      padding: 12px 0;
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 1000;
      box-shadow: 0 0 20px #bb00ff;
      display: flex;
      justify-content: center;
      transition: top 0.3s;
    }
    .nav-content {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 16px;
      max-width: 900px;
      width: 100%;
      align-items: center;
      text-align: center;
    }
    .nav-content a {
      color: white;
      text-decoration: none;
      font-size: 1.2em;
      padding: 7px 10px;
      border-radius: 4px;
      text-shadow: 0 0 8px #00ffcc, 0 0 6px #bb00ff;
      transition: 0.3s;
    }
    .nav-content a:hover {
      background-color: #00ffcc;
      color: #000;
      box-shadow: 0 0 10px #ffffff;
    }
    .search-container {
      width: 210px;
      display: flex;
      justify-content: center;
      margin-left: 12px;
    }
    .search-container input {
      padding: 8px 14px;
      font-size: 1.05em;
      background-color: #111;
      border: 2px solid #00ffcc;
      border-radius: 8px;
      color: #fff;
      box-shadow: 0 0 8px #7b00ff, 0 0 3px #00ffcc;
      text-shadow: 0 0 2px #7b00ff, 0 0 2px #00ffcc;
      width: 100%;
      max-width: 230px;
    }
    .wall-container {
      max-width: 600px;
      margin: 0 auto;
      padding: 12px;
      background: rgba(6, 10, 16, 0.88);
      border-radius: 18px;
      box-shadow: 0 0 22px #00ffe033;
      position: relative;
      z-index: 2;
      min-width: 0;
      margin-top: 52px;
    }
    .wall-title {
      font-size: 2.3em;
      text-align: center;
      color: #aaffee;
      margin: 10px 0 22px 0;
      text-shadow: 0 0 8px #ffffff;
      font-weight: bold;
      letter-spacing: 0.02em;
    }
    .search-filter, .filter-search {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 10px;
      font-size: 1em;
    }
    .search-filter button, .filter-search label {
      background-color: #8000ff;
      border: none;
      padding: 7px 14px;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.99em;
    }
    .search-filter button.active {
      background-color: #00ffcc;
      color: #000;
      font-weight: bold;
    }
    .filter-search input[type="text"] {
      padding: 8px;
      width: 72vw;
      max-width: 370px;
      border-radius: 6px;
      border: 1px solid #7b00ff;
      background-color: #1a1a1a;
      color: #fff;
      font-size: 1em;
      margin-top: 2px;
      margin-bottom: 2px;
    }
    .post {
      background-color: rgba(0, 0, 0, 0.88);
      padding: 15px 12px 8px 12px;
      border-radius: 12px;
      border-left: 4px solid #00ffcc;
      margin-bottom: 22px;
      word-break: break-word;
      box-shadow: 0 0 10px #4ef2ff11;
      position: relative;
    }
    .post strong {
      color: #ccffff;
      font-size: 1.13em;
    }
    .post .post-media {
      margin-top: 8px;
      margin-bottom: 4px;
      max-width: 100%;
      border-radius: 8px;
      box-shadow: 0 0 8px #0ff7;
    }
    .delete-post-btn {
      position: absolute;
      top: 8px;
      right: 10px;
      background: #d62e6e;
      border: none;
      color: white;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.15em;
      padding: 2px 10px 2px 10px;
      z-index: 3;
      opacity: 0.87;
      transition: 0.2s;
    }
    .delete-post-btn:hover { background: #a50044; opacity: 1; }
    .reactions {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 7px 0 0 0;
      align-items: center;
    }
    .reactions button {
      font-size: 1.2em;
      background: none;
      border: none;
      cursor: pointer;
      padding: 3px 8px;
      border-radius: 6px;
      margin: 0;
      transition: background 0.17s;
    }
    .reactions button.selected, .reactions button:hover {
      background: #00ffcc44;
      color: #000;
      font-weight: bold;
    }
    .reaction-count {
      font-size: 0.93em;
      margin-left: 3px;
      margin-right: 8px;
      color: #ccc;
    }
    .comments {
      margin-top: 10px;
      background: #141626;
      border-radius: 7px;
      padding: 7px;
    }
    .comment {
      margin-bottom: 8px;
      display: flex;
      align-items: flex-start;
      gap: 5px;
    }
    .comment-content {
      background: #21243a;
      color: #fff;
      border-radius: 6px;
      padding: 5px 10px;
      font-size: 1em;
      flex: 1;
    }
    .delete-comment-btn {
      background: #d62e6e;
      border: none;
      color: white;
      border-radius: 50%;
      cursor: pointer;
      padding: 0 6px;
      font-size: 0.92em;
      margin-left: 4px;
      margin-top: 2px;
    }
    .comments input[type="text"] {
      width: 90%;
      padding: 7px;
      border-radius: 5px;
      border: 1px solid #00ffcc;
      background-color: #191929;
      color: white;
      font-size: 1em;
      margin-right: 8px;
      margin-top: 7px;
      margin-bottom: 2px;
    }
    .comments button.add-comment-btn {
      background: #00ffcc;
      color: #000;
      font-weight: bold;
      padding: 6px 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 6px;
      font-size: 1em;
    }
    @media (max-width: 600px) {
      nav.navbar { transition: top 0.3s; }
      nav.navbar.hide-navbar { top: -70px; }
      .nav-content { font-size: 1em; gap: 7px; }
      .search-container input { width: 99vw; max-width: 99vw;}
      .wall-container { padding: 3vw; margin-top:30px;}
      .wall-title { font-size: 1.15em; }
      .post { padding: 10px 3vw 7px 3vw; font-size: 0.97em; }
      .filter-search input[type="text"] { width: 98vw; }
    }
  </style>
</head>
<body>
  <div class="glow-left"></div>
  <div class="glow-right"></div>
  <!-- SIDBANNERS -->
  <div class="side-banner left">
    <div class="banner-inner">
      <a id="leftBannerLink" href="#" target="_blank">
        <img id="leftBannerImg" src="https://dummyimage.com/120x1800/7b00ff/fff&text=Reklam+1" alt="Reklam" />
      </a>
    </div>
  </div>
  <div class="side-banner right">
    <div class="banner-inner">
      <a id="rightBannerLink" href="#" target="_blank">
        <img id="rightBannerImg" src="https://dummyimage.com/120x1800/222299/fff&text=Reklam+2" alt="Reklam" />
      </a>
    </div>
  </div>
  <nav class="navbar">
    <div class="nav-content">
      <a href="forum.html" data-t="forum">Forum</a>
      <a href="store.html" data-t="store">Store</a>
      <a href="wall.html" data-t="wall">V√§ggen</a>
      <a href="upload.html" data-t="upload">Ladda upp</a>
      <a href="profile.html" data-t="profile">Profil</a>
      <a href="friends.html" data-t="friends">V√§nner</a>
      <div class="search-container">
        <input type="text" id="searchInputGlobal" data-tph="searchSite" />
      </div>
    </div>
  </nav>
  <div class="wall-container">
    <h1 class="wall-title" id="wallTitle" data-t="wallTitle">Gemensamma Inl√§gg</h1>
    <div class="search-filter">
      <button onclick="setFilter('all')" class="active" data-t="all">Alla</button>
      <button onclick="setFilter('text')" data-t="text">Text</button>
      <button onclick="setFilter('image')" data-t="image">Bild</button>
      <button onclick="setFilter('audio')" data-t="audio">Ljud</button>
      <button onclick="setFilter('video')" data-t="video">Klipp</button>
      <button onclick="setFilter('combo')" data-t="combo">Kombinerat</button>
    </div>
    <div class="filter-search">
      <input type="text" id="localSearchInput" data-tph="searchWall" oninput="filterPosts()" />
    </div>
    <div id="postsContainer"></div>
  </div>
  <script>
    // SIDBANNER ROTATION
    const banners = [
      {
        left: { src: "https://dummyimage.com/120x1800/7b00ff/fff&text=Reklam+1", alt: "Reklam Banner 1", url: "#" },
        right: { src: "https://dummyimage.com/120x1800/222299/fff&text=Reklam+2", alt: "Reklam Banner 2", url: "#" }
      },
      {
        left: { src: "https://dummyimage.com/120x1800/ff0088/fff&text=Bli+medlem!", alt: "Bli medlem", url: "register.html" },
        right: { src: "https://dummyimage.com/120x1800/0077ff/fff&text=Annonsera+H√§r", alt: "Annonsera", url: "#" }
      }
    ];
    let bannerIndex = 0;
    function updateBanners() {
      const left = banners[bannerIndex].left;
      const right = banners[bannerIndex].right;
      document.getElementById('leftBannerImg').src = left.src;
      document.getElementById('leftBannerImg').alt = left.alt;
      document.getElementById('leftBannerLink').href = left.url;
      document.getElementById('rightBannerImg').src = right.src;
      document.getElementById('rightBannerImg').alt = right.alt;
      document.getElementById('rightBannerLink').href = right.url;
    }
    updateBanners();
    setInterval(() => {
      bannerIndex = (bannerIndex + 1) % banners.length;
      updateBanners();
    }, 6000);

    // S√∂k-f√§lt
    document.addEventListener("DOMContentLoaded", () => {
      const searchInput = document.getElementById("searchInputGlobal");
      if (searchInput) {
        searchInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            const query = searchInput.value.trim();
            if (query.length >= 2) {
              window.location.href = "search.html?q=" + encodeURIComponent(query);
            }
          }
        });
      }
    });

    // Navbar hide vid scroll p√• mobil
    if (window.innerWidth <= 600) {
      let lastScrollY = window.scrollY;
      let navbar = document.querySelector('.navbar');
      window.addEventListener('scroll', function () {
        if (window.scrollY > lastScrollY && window.scrollY > 70) {
          navbar.classList.add('hide-navbar');
        } else {
          navbar.classList.remove('hide-navbar');
        }
        lastScrollY = window.scrollY;
      });
    }
  </script>
  <script type="module">
    // --- SPR√ÖKST√ñD ---
    const lang = localStorage.getItem('language') || 'sv';
    const texts = {
      sv: {
        forum: "Forum", store: "Butik", wall: "V√§ggen", upload: "Ladda upp", profile: "Profil", friends: "V√§nner",
        searchSite: "S√∂k p√• hela sidan...", wallTitle: "Gemensamma Inl√§gg",
        all: "Alla", text: "Text", image: "Bild", audio: "Ljud", video: "Klipp", combo: "Kombinerat",
        searchWall: "S√∂k inl√§gg p√• v√§ggen...",
        commentPlaceholder: "Kommentera...", commentBtn: "Kommentera",
        loginComment: "Logga in f√∂r att kommentera",
        deletePost: "üóëÔ∏è Ta bort", confirmDelete: "Vill du ta bort detta inl√§gg?",
        deleteComment: "üóëÔ∏è", loading: "Laddar...", noPosts: "Inga inl√§gg √§nnu!",
        removeReaction: "‚ùå Ta bort reaktion", needLoginReact: "Du m√•ste vara inloggad f√∂r att reagera.",
        needLoginComment: "Du m√•ste vara inloggad f√∂r att kommentera.", maxWords: "Max 200 ord!",
        replyBtn: "Svara", loginReply: "Logga in f√∂r att svara", removeReply: "Ta bort svar"
      },
      en: {
        forum: "Forum", store: "Store", wall: "Wall", upload: "Upload", profile: "Profile", friends: "Friends",
        searchSite: "Search the site...", wallTitle: "All Posts",
        all: "All", text: "Text", image: "Image", audio: "Audio", video: "Video", combo: "Mixed",
        searchWall: "Search posts on wall...",
        commentPlaceholder: "Comment...", commentBtn: "Comment",
        loginComment: "Log in to comment",
        deletePost: "üóëÔ∏è Delete", confirmDelete: "Do you want to delete this post?",
        deleteComment: "üóëÔ∏è", loading: "Loading...", noPosts: "No posts yet!",
        removeReaction: "‚ùå Remove reaction", needLoginReact: "You need to be logged in to react.",
        needLoginComment: "You need to be logged in to comment.", maxWords: "Max 200 words!",
        replyBtn: "Reply", loginReply: "Log in to reply", removeReply: "Remove reply"
      }
    };
    function tr(key) { return (texts[lang] && texts[lang][key]) || key; }
    function applyLang() {
      document.querySelectorAll('[data-t]').forEach(el => el.textContent = tr(el.getAttribute('data-t')));
      document.querySelectorAll('[data-tph]').forEach(el => el.placeholder = tr(el.getAttribute('data-tph')));
    }
    applyLang();

    import { auth, db } from './scripts/firebase-init.js';
    import {
      collection, query, orderBy, onSnapshot, doc, getDocs, setDoc, addDoc, updateDoc, deleteDoc
    } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

    // REACTIONS
    const reactionsList = [
      { key: "heart", emoji: "‚ù§Ô∏è" }, { key: "thumbs_up", emoji: "üëç" }, { key: "laugh", emoji: "üòÇ" },
      { key: "happy", emoji: "üòä" }, { key: "embarrassed", emoji: "üò≥" }, { key: "angel", emoji: "üòá" },
      { key: "surprised", emoji: "üò≤" }, { key: "sad", emoji: "üò¢" }, { key: "cry", emoji: "üò≠" },
      { key: "thumbs_down", emoji: "üëé" }, { key: "broken_heart", emoji: "üíî" }
    ];
    let currentUser = null;
    auth.onAuthStateChanged(user => { currentUser = user; });

    // FILTER
    let currentTypeFilter = 'all', currentSearch = '';
    function setFilter(type) {
      currentTypeFilter = type;
      document.querySelectorAll('.search-filter button').forEach(btn =>
        btn.classList.toggle('active', btn.getAttribute('data-t') === type)
      );
      filterPosts();
    }
    window.setFilter = setFilter;
    function filterPosts() {
      const search = document.getElementById("localSearchInput").value.toLowerCase();
      currentSearch = search;
      document.querySelectorAll('.post').forEach(postEl => {
        const text = postEl.innerText.toLowerCase();
        const type = postEl.dataset.type;
        const showType = (currentTypeFilter === 'all' || type === currentTypeFilter);
        const showSearch = !search || text.includes(search);
        postEl.style.display = (showType && showSearch) ? '' : 'none';
      });
    }

    // ---------- INB√ÑDDNING AV L√ÑNKAR ----------
    function embedLinks(text) {
      if (!text) return "";
      let html = text.replace(/(https?:\/\/[^\s]+)/g, url => {
        // YouTube
        if (/youtu\.be|youtube\.com/.test(url)) {
          let vid = url.match(/(?:youtu\.be\/|youtube\.com.*[?&]v=)([\w\-]+)/);
          if (vid && vid[1]) {
            return `<iframe width="360" height="210" style="max-width:99%;margin:6px 0;" src="https://www.youtube.com/embed/${vid[1]}" frameborder="0" allowfullscreen></iframe>`;
          }
        }
        // TikTok
        if (/tiktok\.com/.test(url)) {
          return `<blockquote class="tiktok-embed" cite="${url}" style="max-width:325px;min-width:220px;"><a href="${url}">TikTok</a></blockquote>
                  <script async src="https://www.tiktok.com/embed.js"></script>`;
        }
        // Spotify
        if (/open\.spotify\.com/.test(url)) {
          return `<iframe src="https://open.spotify.com/embed${url.split('spotify.com')[1]}" width="320" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media" style="max-width:99%"></iframe>`;
        }
        // Annars: l√§nk som vanligt
        return `<a href="${url}" target="_blank" rel="noopener">${url}</a>`;
      });
      return html;
    }

    // ---------- WALL RENDER ----------
    function renderMedia(post) {
      let html = "";
      if (post.imageUrl) html += `<img class="post-media" src="${post.imageUrl}" alt="Bild" />`;
      if (post.videoUrl) html += `<video class="post-media" src="${post.videoUrl}" controls></video>`;
      if (post.audioUrl) html += `<audio class="post-media" src="${post.audioUrl}" controls></audio>`;
      if (post.micAudioUrl) html += `<audio class="post-media" src="${post.micAudioUrl}" controls></audio>`;
      return html;
    }

    function renderReactions(post, postId, userReaction, counts) {
      return `
        <div class="reactions">
          ${reactionsList.map(r => `
            <button
              ${userReaction === r.key ? 'class="selected"' : ''}
              onclick="window.setReaction('${postId}','${r.key}')"
              title="Reagera med ${r.emoji}"
              >${r.emoji} <span class="reaction-count">${counts[r.key] || ''}</span></button>
          `).join("")}
          ${userReaction ? `<button onclick="window.removeReaction('${postId}')">${tr('removeReaction')}</button>` : ""}
        </div>`;
    }

    // --- Reagera p√• post
    window.setReaction = async (postId, key) => {
      if (!currentUser) { alert(tr("needLoginReact")); return; }
      const ref = doc(db, "wall", postId, "reactions", currentUser.uid);
      await updateDoc(ref, { type: key }, { merge: true }).catch(async() => {
        await setDoc(ref, { type: key });
      });
    };
    window.removeReaction = async (postId) => {
      if (!currentUser) return;
      await deleteDoc(doc(db, "wall", postId, "reactions", currentUser.uid));
    };

    // --- Kommentera och svara
    window.addComment = async (postId, inputId, parentCommentId = null) => {
      const input = document.getElementById(inputId);
      const content = input.value.trim();
      if (!content) return;
      if (!currentUser) { alert(tr("needLoginComment")); return; }
      if (content.split(/\s+/).length > 200) { alert(tr("maxWords")); return; }
      await addDoc(collection(db, "wall", postId, "comments"), {
        content, user: currentUser.uid, createdAt: new Date(), parent: parentCommentId || null
      });
      input.value = "";
    };
    window.deleteComment = async (postId, commentId) => {
      if (!currentUser) return;
      await deleteDoc(doc(db, "wall", postId, "comments", commentId));
    };

    // --- Radera post
    window.deletePost = async (postId, userId) => {
      if (!currentUser || currentUser.uid !== userId) return;
      if (!confirm(tr("confirmDelete"))) return;
      await deleteDoc(doc(db, "wall", postId));
    };

    // --- Visa kommentarer i tr√•dstruktur
    function renderComments(comments, postId, parentId = null, level = 0) {
      return comments
        .filter(c => c.parent === parentId)
        .map(c =>
          `<div class="comment" style="margin-left:${level*18}px">
            <div class="comment-content">${embedLinks(c.content)}</div>
            ${currentUser && c.user === currentUser.uid
              ? `<button class="delete-comment-btn" title="${tr('deleteComment')}" onclick="window.deleteComment('${postId}','${c.id}')">${tr('deleteComment')}</button>`
              : ''
            }
            <button class="add-comment-btn" onclick="window.replyToComment('${postId}','${c.id}')" style="margin-left:7px;font-size:0.92em;">${tr('replyBtn')}</button>
            <div id="reply-box-${postId}-${c.id}" style="margin-left:2px"></div>
            ${renderComments(comments, postId, c.id, level+1)}
          </div>`
        ).join("");
    }
    window.replyToComment = function(postId, commentId) {
      const box = document.getElementById(`reply-box-${postId}-${commentId}`);
      if (!box.innerHTML) {
        box.innerHTML = `<input type="text" id="reply-input-${postId}-${commentId}" placeholder="${tr('commentPlaceholder')}" maxlength="500" style="margin-top:5px;width:92%" />
          <button class="add-comment-btn" onclick="window.addComment('${postId}','reply-input-${postId}-${commentId}','${commentId}')">${tr('commentBtn')}</button>`;
      } else {
        box.innerHTML = "";
      }
    }

    function renderPost(post, postId, userReaction, reactionCounts, comments, userId) {
      return `
        <div class="post" data-type="${post.type}">
          ${currentUser && currentUser.uid === userId ?
            `<button class="delete-post-btn" onclick="window.deletePost('${postId}','${userId}')">${tr('deletePost')}</button>` : ""}
          <div>
            <strong>${post.text ? embedLinks(post.text) : ''}</strong>
            ${renderMedia(post)}
          </div>
          ${renderReactions(post, postId, userReaction, reactionCounts)}
          <div class="comments">
            <div>
              ${renderComments(comments, postId)}
            </div>
            ${currentUser ? `
              <input type="text" placeholder="${tr('commentPlaceholder')}" id="comment-input-${postId}" maxlength="1000" />
              <button class="add-comment-btn" onclick="window.addComment('${postId}','comment-input-${postId}')">${tr('commentBtn')}</button>
            ` : `<div style="color:#f44;font-size:0.96em;">${tr('loginComment')}</div>`}
          </div>
        </div>
      `;
    }

    // --- LADDA IN V√ÑGG
    function listenToWall() {
      const postsContainer = document.getElementById("postsContainer");
      const q = query(collection(db, "wall"), orderBy("createdAt", "desc"));
      onSnapshot(q, async snapshot => {
        postsContainer.innerHTML = tr("loading");
        let html = "";
        let postsArr = [];
        for (const docSnap of snapshot.docs) {
          const post = docSnap.data();
          post.id = docSnap.id;
          postsArr.push(post);
        }
        for (const post of postsArr) {
          let reactionsDocs = await getDocs(collection(db, "wall", post.id, "reactions"));
          let reactionCounts = {}, userReaction = null;
          reactionsDocs.forEach(rDoc => {
            const r = rDoc.data().type;
            if (rDoc.id === (currentUser && currentUser.uid)) userReaction = r;
            reactionCounts[r] = (reactionCounts[r] || 0) + 1;
          });

          let commentsDocs = await getDocs(collection(db, "wall", post.id, "comments"));
          let comments = [];
          commentsDocs.forEach(cDoc => {
            let c = cDoc.data();
            c.id = cDoc.id;
            comments.push(c);
          });
          comments.sort((a, b) => a.createdAt && b.createdAt ? a.createdAt.seconds - b.createdAt.seconds : 0);

          html += renderPost(post, post.id, userReaction, reactionCounts, comments, post.user);
        }
        postsContainer.innerHTML = html || `<div style="text-align:center;color:#99d">${tr('noPosts')}</div>`;
        filterPosts();
      });
    }
    listenToWall();
  </script>
</body>
</html>
